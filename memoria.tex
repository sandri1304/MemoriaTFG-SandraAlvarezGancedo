%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Plantilla de memoria en LaTeX para la ETSIT - Universidad Rey Juan Carlos
%%
%% Por Gregorio Robles <grex arroba gsyc.urjc.es>
%%     Grupo de Sistemas y Comunicaciones
%%     Escuela Técnica Superior de Ingenieros de Telecomunicación
%%     Universidad Rey Juan Carlos
%% (muchas ideas tomadas de Internet, colegas del GSyC, antiguos alumnos...
%%  etc. Muchas gracias a todos)
%%
%% La última versión de esta plantilla está siempre disponible en:
%%     https://github.com/gregoriorobles/plantilla-memoria
%%
%% Para obtener PDF, ejecuta en la shell:
%%   make
%% (las imágenes deben ir en PNG o JPG)

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\documentclass[a4paper, 12pt]{report}
%\usepackage[T1]{fontenc}

\usepackage[a4paper, left=2.5cm, right=2.5cm, top=3cm, bottom=3cm]{geometry}
\usepackage{times}
\usepackage[latin1]{inputenc}
\usepackage[spanish]{babel} % Comenta esta línea si tu memoria es en inglés
\usepackage{url}
%\usepackage[dvipdfm]{graphicx}
\usepackage{graphicx}
\usepackage{float}  %% H para posicionar figuras
\usepackage[nottoc, notlot, notlof, notindex]{tocbibind} %% Opciones de índice
\usepackage{latexsym}  %% Logo LaTeX
\usepackage{subfig}

\title{Memoria del Proyecto}
\author{Nombre del autor}

\renewcommand{\baselinestretch}{1.5}  %% Interlineado

\begin{document}

\renewcommand{\refname}{Bibliografía}  %% Renombrando
\renewcommand{\appendixname}{Apéndice}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% PORTADA

\begin{titlepage}
\begin{center}
\begin{tabular}[c]{c c}
%\includegraphics[bb=0 0 194 352, scale=0.25]{logo} &
\includegraphics[scale=0.25]{img/logo_vect.png} &
\begin{tabular}[b]{l}
\Huge
\textsf{UNIVERSIDAD} \\
\Huge
\textsf{REY JUAN CARLOS} \\
\end{tabular}
\\
\end{tabular}

\vspace{3cm}

\Large
GRADO EN TECNOLOGÍAS DE LA TELECOMUNICACIÓN

\vspace{0.4cm}

\large
Curso Académico 2019/2020

\vspace{0.8cm}

Trabajo Fin de Grado

\vspace{2.5cm}

\LARGE
DISEÑO Y DESARROLLO DE APLICACIONES WEB DE ÚLTIMA GENERACIÓN

\vspace{0.4cm}

\large
Aplicación web de comercio electrónico para una tienda de electrodomésticos

\vspace{4cm}

\large
Autor : Sandra Álvarez Gancedo \\
Tutor : Dr. Gregorio Robles
\end{center}
\end{titlepage}

\newpage
\mbox{}
\thispagestyle{empty} % para que no se numere esta pagina


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%% Para firmar
\clearpage
\pagenumbering{gobble}
\chapter*{}

\vspace{-4cm}
\begin{center}
\LARGE
\textbf{Trabajo Fin de Grado}

\vspace{1cm}
\large
Aplicación web de comercio electrónico para una tienda de electrodomésticos (Nevado)

\vspace{1cm}
\large
\textbf{Autor :} Sandra Álvarez Gancedo\\
\textbf{Tutor :} Dr. Gregorio Robles Martínez

\end{center}

\vspace{1cm}
La defensa del presente Proyecto Fin de Carrera se realizó el día \qquad$\;\,$ de \qquad\qquad\qquad\qquad \newline de 2020, siendo calificada por el siguiente tribunal:


\vspace{0.5cm}
\textbf{Presidente:}

\vspace{1.2cm}
\textbf{Secretario:}

\vspace{1.2cm}
\textbf{Vocal:}


\vspace{1.2cm}
y habiendo obtenido la siguiente calificación:

\vspace{1cm}
\textbf{Calificación:}


\vspace{1cm}
\begin{flushright}
Fuenlabrada, a \qquad$\;\,$ de \qquad\qquad\qquad\qquad de 2020
\end{flushright}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%% Dedicatoria

\chapter*{}
\pagenumbering{Roman} % para comenzar la numeracion de paginas en numeros romanos
\begin{flushright}
\textit{Un esfuerzo total \\
es una victoria completa \\
Mahatma Gandhi} 
\end{flushright}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%% Agradecimientos

\chapter*{Agradecimientos}
%\addcontentsline{toc}{chapter}{Agradecimientos} % si queremos que aparezca en el índice
\markboth{AGRADECIMIENTOS}{AGRADECIMIENTOS} % encabezado 

En primer lugar quiero agradecer a mis padres, pues sin ellos y sin su esfuerzo no hubiese sido capaz de cerrar este ciclo. Muchas han sido las noches que habéis estado a mi lado, aguantando mis desvelos, mis nervios y mis miedos. Habéis sido el consuelo y el apoyo que necesitaba en mis momentos más duros, en los que únicamente un simple gesto vuestro hacía levantarme. Sois y seréis mi mejor ejemplo a seguir. 

La vida me ha regalado unos segundos padres, mis tíos, los cuales me quieren y me protegen como a una hija. Me habéis acompañado en los momentos más felices, pero también en los más difíciles, incluso cuando a mis padres les faltaban fuerzas para seguir adelante. Simplemente deciros, gracias.

Mi primo, más que un hermano. Cuantos momentos vividos, siempre liándola, en las buenas y las no tan buenas, pero siempre juntos. Nos separamos en esta etapa universitaria, pero nuestras carreras eran tan iguales que nos ha permitido seguir ayudándonos. 

Quiero agradecer a mis abuelos, a mi abuelo por enseñarme lo que es la vida. Por enseñarme que de todo lo malo también hay que saber sacar el lado positivo. A mi abuela, porque sé que desde algún rinconcito del cielo ha visto como lograba alcanzar todos mis sueños y mis metas. Pero sobre todo sé, que desde ahí arriba, me ha ayudado a luchar y a salir hacia delante ante el mayor reto de mi vida. Sé que estarás orgullosa de mí. 

La universidad me ha aportado muchas cosas buenas, pero gracias a ella, conocí a quien es hoy uno de mis pilares, Alejandro. Se ha convertido en mi mejor amigo, mi confidente, mi compañero de viaje, mi otra mitad. Gracias por todo lo que has hecho y haces por mí. Me has ayudado en la universidad, pues sin ti, no sé si hubiese sido capaz de aprobar aquella asignatura que me traía por el camino de la amargura. Pero, sobre todo, me has ayudado en la vida, te quedaste a mi lado en el peor momento, cuando a todos nos invadía la incertidumbre, cuando ninguno sabía que iba a pasar, ahí estuviste conmigo. Me has dado fuerzas cuando más flaqueaba, me has sacado una sonrisa cuando más lo necesitaba, y me has dado entereza para asumir y afrontar lo que me estaba pasando. Ha habido muchos momentos malos durante estos 5 años, pero juntos los hemos superado y así seguiremos haciéndolo. 

Agradecer a mis compañeros y amigos de universidad por todos los apuntes y conocimientos intercambiados.

A mis profesores, en especial a Antonio García Marqués y Carlos Figueras, pues me ayudaron, me apoyaron y me dieron facilidades para poder sacar adelante la asignatura PDAC, a pesar de mis condiciones. Recuerdo, con cariño, el \emph{email} de Antonio para comunicarme que había conseguido aprobar la asignatura y felicitarme por ello, pues sabía del esfuerzo realizado. 

Quiero hacer mención especial a mi tutor de proyecto, Gregorio Robles, por darme ánimos para terminar el Trabajo Fin de Grado. Pero, sobre todo, gracias por ser paciente, por entender y comprender mi situación. 

Y, por último, no me puedo olvidar de todos los médicos y enfermeras que me han atendido durante estos cinco años, puesto que, sin su esfuerzo, su investigación y su predisposición, no hubiese podido terminar esta etapa. 

Agradecer a la vida, porque a pesar de todo he tenido suerte. Suerte por tener a la gente que tengo a mi lado, por haber podido estudiar, pero, sobre todo, suerte porque no todos pueden decir que han superado una enfermedad, como es un linfoma. Y, por qué no, gracias a ti, linfoma, porque me has enseñado a disfrutar y vivir la vida al máximo y a dar importancia a las cosas que realmente las tienen.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%% Resumen

\chapter*{Resumen}
%\addcontentsline{toc}{chapter}{Resumen} % si queremos que aparezca en el índice
\markboth{RESUMEN}{RESUMEN} % encabezado

El Trabajo Fin de Grado tiene como objetivo principal desarrollar una aplicación web de comercio electrónico para la venta de electrodomésticos.

Gracias a aplicaciones como la que se desarrolla en este trabajo, pequeños comercios pueden ampliar su mercado y llegar a más gente, pues simplemente accediendo a la web se puede ver la variedad de productos que hay en el catálogo, conocer su precio y realizar la compra sin tener la necesidad de ir a la tienda física. 

Destacar que además de la venta de electrodomésticos, la aplicación permite al administrador, dueño del comercio, gestionar los clientes, los productos, las ofertas, los pedidos y las facturas. Pensando en esta gestión, se implementa un sistema de importación y exportación de ficheros Excel que permite al administrador cargar productos de manera masiva sin tener que ir uno a uno, agilizando el trabajo del  administrador. 

La aplicación está diseñada para que cualquier usuario pueda navegar por ella, sin ningún tipo de dificultad. Se han adaptado las distintas vistas a las resoluciones de pantalla más comunes, de tal forma que se pueda manejar tanto en un móvil como en un ordenador, sin que se produzca ningún menoscabo de la usabilidad. Esto ha propiciado que para el desarrollo de la aplicación se  hayan elegido las siguientes tecnologías: HTML5, CSS3, Bootstrap, Angular 7 y TypeScript (para la parte del cliente) y Node.js, MongoDB y JavaScript (para la parte del servidor).

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%% Resumen en inglés

\chapter*{Summary}
%\addcontentsline{toc}{chapter}{Summary} % si queremos que aparezca en el índice
\markboth{SUMMARY}{SUMMARY} % encabezado

The main objective of the project is to develop an e-commerce web application for the sale of household appliances.

Thanks to applications such as the one developed in this work, small shops can expand their market and reach more people, because by simply accessing the web you can see the variety of products in the catalogue, know their price and make the purchase without having to go to the physical shop. 

It should be noted that in addition to selling household appliances, the application allows the administrator, owner of the shop, to manage customers, products, offers, orders and invoices. With this management in mind, an Excel file import and export system is implemented that allows the administrator to load products en masse without having to go one by one, speeding up the administrator's work. 

The application is designed so that any user can browse it, without any difficulty. The different views have been adapted to the most common screen resolutions, so that it can be used both on a mobile phone and on a computer, without any deterioration in usability. This has meant that the following technologies have been chosen for the development of the application: HTML5, CSS3, Bootstrap, Angular 7 and TypeScript (for the client side) and Node.js, MongoDB and JavaScript (for the server side).


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% ÍNDICES %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Las buenas noticias es que los índices se generan automáticamente.
% Lo único que tienes que hacer es elegir cuáles quieren que se generen,
% y comentar/descomentar esa instrucción de LaTeX.

%%%% Índice de contenidos
\tableofcontents 
%%%% Índice de figuras
\cleardoublepage
%\addcontentsline{toc}{chapter}{Lista de figuras} % para que aparezca en el indice de contenidos
\listoffigures % indice de figuras
%%%% Índice de tablas
%\cleardoublepage
%\addcontentsline{toc}{chapter}{Lista de tablas} % para que aparezca en el indice de contenidos
%\listoftables % indice de tablas


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% INTRODUCCIÓN %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\cleardoublepage
\chapter{Introducción}
\label{sec:intro} % etiqueta para poder referenciar luego en el texto con~\ref{sec:intro}
\pagenumbering{arabic} % para empezar la numeración de página con números

El comercio es el intercambio de mercancías y géneros en el mercado de la compra-venta. 

Si nos remontamos a la antigüedad, se puede ver cómo los primeros hombres ya usaban un sistema de trueque para intercambiar pieles, alimentos o animales. Este sistema de trueque ha ido evolucionando conforme iba avanzando la humanidad, surgiendo el comercio tal y como se conoce actualmente.

Gran parte de esta evolución ha venido dada por el avance de la tecnología, ya que aunque no ha supuesto un gran cambio en el concepto de comercio sí lo ha hecho en la manera de comercializar. Hace unos años no se entendía el comercio sin tener que desplazarse a una tienda física. 

Con el nacimiento de Internet, aparecieron las primeras transacciones comerciales \emph{online}. Fue en el año 1981 cuando se realizó la primera de todas ellas. A pesar de ello, no empezó a adquirir popularidad entre las grandes compañías de comercio hasta el año 1994, cuando Netscape implantó SSL, que proporcionaba mayor seguridad en las transacciones, y cuando empezaron a surgir los primeros servicios de terceros para el procesamiento en línea de tarjetas de crédito. Muchas de estas compañías invirtieron grandes fortunas, pensando en el boom que tendría este tipo de comercio. Pero no fue hasta el año 2004 cuando empezó a adquirir popularidad, ya que la aparición del \emph{Consejo de Normas de Seguridad} para las tarjetas de pago daba mayor seguridad a la hora de realizar las compras. 

A pesar de todo, las personas seguían siendo muy reticentes a comprar por Internet por el miedo a que les clonasen sus datos bancarios. La creación de pasarelas de pago totalmente seguras, como la implantación, por parte de las entidades financieras, de tarjetas de crédito recargables hizo que la gente fuese perdiendo el miedo y que el comercio electrónico despegara como esperaban las grandes compañías. Además, el uso de los dispositivos móviles, como \emph{smartphones} o \emph{tablets}, así como la aparición de las redes sociales, donde te permiten publicar anuncios para promocionar productos y servicios, ha provocado que el comercio no se entienda sin el comercio electrónico. Teniendo en cuenta la importancia de los dispositivos móviles en este tipo de ventas \emph{online}, se entiende que todas las tiendas quieran adaptar sus aplicaciones web a estos dispositivos y plataformas. 

El comercio electrónico, además de suponer un canal adicional de ventas, tiene la ventaja de permitir nuevos mercados y ampliar posibilidades de negocio, lo que hace que aquellas tiendas pequeñas en las que todavía no se ha implantado este tipo de comercio quieran hacerlo. De esta necesidad, surgió la idea de realizar este proyecto, ya que me permitía ampliar mis conocimientos tecnológicos. 

\section{Estructura de la memoria}
\label{sec:estructura}

La memoria comienza con un resumen, en el cual se explica de manera breve en que consiste el proyecto, así como las tecnologías que se han usado para desarrollarlo. A continuación, se sitúan los agradecimientos y los dos índices, el índice general y el índice de figuras. Por último, van los 6 capítulos en los que se divide la memoria y los apéndices.   

\begin{itemize}
  \item \textbf{Capítulo 1: Introducción.} Se describe de manera general en que consiste el proyecto. Especificándose cuál es la estructura de la memoria.
  
  \item \textbf{Capítulo 2: Objetivos y motivaciones.} Se describen los objetivos que se pretenden alcanzar con el desarrollo y finalización del proyecto. Se detallan las motivaciones por las cuales se ha decidido realizar una aplicación web de comercio electrónico.
  
  \item \textbf{Capítulo 3: Estado del arte.} Se explican las tecnologías usadas en el desarrollo de la aplicación. 

  \item \textbf{Capítulo 4: Diseño e implementación.} Se describe de manera detallada la arquitectura, el diseño e implementación del servidor, el diseño de la base de datos y el diseño e implementación del cliente.

  \item \textbf{Capítulo 5: Resultados.} Se analiza si se ha conseguido alcanzar el resultado esperado. 

  \item \textbf{Capítulo 6: Conclusiones.} Se detallan las conclusiones obtenidas con el desarrollo de la aplicación, los conocimientos que se han afianzado y adquirido. Y, por último, las posibles líneas futuras que se podrían desarrollar para mejorar la aplicación. 

  \item \textbf{Apéndice A: Manual de instalación.} Se explica todo lo que se debe instalar para que la aplicación funcione correctamente en cualquier equipo, siempre en un entorno  local. 

  \item \textbf{Apéndice B: Manual de usuario.} Se describen los pasos que el cliente debe seguir para la finalización de la compra \emph{online}. 
  
\end{itemize}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% OBJETIVOS %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\cleardoublepage % empezamos en página impar
\chapter{Objetivos} % título del capítulo (se muestra)
\label{chap:objetivos} % identificador del capítulo (no se muestra, es para poder referenciarlo)

\section{Objetivo general} % título de sección (se muestra)
\label{sec:objetivo-general} % identificador de sección (no se muestra, es para poder referenciarla)

El objetivo principal de este Trabajo Fin de Grado es el desarrollo de una aplicación web de comercio electrónico.

A través de la aplicación se podrán realizar compras de productos electrónicos sin necesidad de ir a una tienda física y se llevará a cabo la administración de dicha tienda \emph{online} por parte del dueño o administrador del comercio.


\section{Objetivos específicos}
\label{sec:objetivos-especificos}

Para cumplir con el objetivo principal es necesario alcanzar los siguientes objetivos específicos: 
\begin{itemize}
\item La aplicación web debe ser \emph{responsive}, esto quiere decir que se debe adaptar a cualquier tipo de resolución de pantalla sin perder funcionalidad, ya que los clientes realizarán sus compras a través de diferentes navegadores y dispositivos móviles.

\item La interfaz de la aplicación web deber ser sencilla, de tal forma que realizar una compra sea rápido y sencillo para cualquier usuario, incluso para aquellos que no tienen ningún tipo de conocimiento en informática y comercio electrónico.

\item Puesto que  se van a tratar datos personales susceptibles, la aplicación debe cumplir con los requisitos básicos de protección de datos. Además, debe ser robusta y segura a la hora de realizar los pagos. 

\item La competitividad con otras aplicaciones web de comercio electrónico de electrodomésticos vendrá determinada por una interfaz atractiva y por funcionalidades como la calificación y valoración de los productos por parte de los clientes.

\item La aplicación debe ser lo más modulable posible. Esto permitirá que, ante un cambio en los requerimientos y necesidades de la tienda, la aplicación se adapte de manera fácil y rápida. 

\item Diseñar un sistema de administración que permita al dueño del comercio llevar un control de los clientes, los productos, los pedidos y las facturas, así como de los proveedores de productos y del transporte de los mismos. 

\item Implementar un sistema de importación y exportación de ficheros Excel que permita el manejo de grandes volúmenes de datos. 

\item Implementar un sistema de mensajería que permita la comunicación entre los clientes y el administrador.

\item Generación de las facturas en PDF para que se puedan enviar junto a los productos.

\end{itemize}


\section{Motivación}
\label{sec:motivaciones}
En la actualidad, las tiendas \emph{online} están en pleno auge y son un pilar fundamental para el ámbito comercial, cada vez más personas deciden realizar sus compras a través de internet. Este hecho, junto con la motivación de realizar un proyecto ambicioso, fue lo que hizo que desarrollase esta aplicación.

Este desarrollo me permitía poner en práctica la mayoría de los conocimientos adquiridos en el transcurso del grado. También, me permitía adquirir nuevos conocimientos que me servirán para adentrarme en el mundo laboral del comercio electrónico. Suponía una motivación más enfrentarme a nuevos retos aprendiendo tecnologías nuevas como Node.js, Angular, TypeScript o MongoDB y me servía para demostrarme que soy capaz de resolver cualquier conflicto que se plantee durante el transcurso del desarrollo con esfuerzo y dedicación, aumentando así mi confianza en afrontar nuevos proyectos de cara a mi carrera profesional. 

%\section{Planificación temporal}
%\label{sec:planificacion-temporal}


%\begin{figure}[H]
%  \centering
%  \includegraphics[width=9cm, keepaspectratio]{img/planificacion_temporal}
%  \caption{Planificación temporal:Diagrama de GANTT.}
%  \label{fig:GANTT}
%\end{figure}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% ESTADO DEL ARTE %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\cleardoublepage
\chapter{Estado del arte}
\label{chap:estado}


Para el desarrollo de este Trabajo Fin de Grado se han utilizado diferentes tecnologías, las cuales se explicarán a continuación. 



\section{HTML5} 
\label{sec:HTML5}

HTML5 (HyperText Markup Language)~\cite{HTML} es la quinta y última versión de HTML, lenguaje estándar utilizado para la definición y estructuración de los contenidos de las páginas web.

Se trata de una versión muy diferente a versiones anteriores, ya que su desarrollo se dio por discrepancias entre diferentes miembros del consorcio W3C. En el año 2004, WATWG (Web HyperText Application Technology Working Group) sacó una primera versión, para el asombro de todos. Pero fue en el año 2009, y en colaboración con WATWG, cuando W3C comenzó con el desarrollo de la especificación de HTML5. 

Fue creado con la intención de sustituir a la versión anterior de HTML (HTML4), pero también se pretendía que la aparición de esta nueva versión relevará otros lenguajes como XHTML1 y DOM Nivel 2. 

Esta versión, además de incluir nuevas etiquetas y atributos, proporciona una plataforma de desarrollo para la creación de aplicaciones web complejas. Entre las nuevas funcionalidades se encuentran los siguientes puntos:  

\begin{itemize}
\item Incorporación de elementos multimedia para reproducir sonidos y vídeos desde el propio navegador. Estos elementos multimedia son las etiquetas $<audio>$ y $<video>$.
\item Integración de gráficos vectoriales escalables (SVG).
\item Incorporación del elemento $<canvas>$, el cual permite dibujar y recrear animaciones en el navegador.
\item Almacenamiento local en el lado del cliente, con $localStorage$ y $SeassionStorage$.
\item Incorporación de etiquetas que permiten la estructuración de los documentos HTML, sin recurrir al uso de $<div>$. Entre estas etiquetas se encuentran $<header>$ y $<footer>$, muy útiles para la creación de la cabecera y el pie de la página HTML.
\item Incorporación de $MathML$ para el manejo de fórmulas matemáticas en los documentos web. 
\end{itemize}

\section{CSS3} 
\label{sec:CSS3}

CSS3 (Cascading Style Sheets)~\cite{CSS3} es la última versión de CSS. Es un lenguaje de programación que permite definir y crear el aspecto visual de los documentos web. 

Surgió de la necesidad de separar el contenido de los documentos HTML5 de su estilo, permitiendo crear documentos web más simples. Además, permite que un mismo documento web tenga varias hojas de estilo, facilitando así, por ejemplo, el diseño \emph{responsive}, ya que una misma información necesita estilos distintos para los diferentes tipos de pantalla. Del mismo modo que un documento puede tener varias hojas de estilo, una misma hoja puede ser reutilizada en varios documentos web, simplificando el trabajo de los desarrolladores. 

Es un lenguaje simple, que se basa en reglas para definir los aspectos visuales del documento web. Como resumen, su propio nombre es capaz de proporcionar la información necesaria que define el lenguaje: 

\begin{itemize}
\item Cascading: El estilo que se aplica al elemento padre del documento web también se aplica a los elementos hijos que contenga, propagándose en forma de cascada. 
\item Style: Es un lenguaje que define el estilo y el aspecto visual de los documentos HTML. 
\item Sheets: Los estilos se añaden en ficheros, denominados hojas, cuya extensión es .css. Estas hojas pueden ser utilizadas en diferentes documentos HTML, permitiendo así la simplicidad y flexibilidad en los documentos web. 

\end{itemize}

Algunas de las novedades más importantes que introduce esta versión de CSS son: transiciones, sombras en cajas, gradientes, esquinas redondeadas, múltiples imágenes en fondo, opacidad o transparencia de los colores, entre otras. 

El encargado de definir y mantener las especificaciones de este lenguaje es World Wide Web Consortium (W3C).

\section{JavaScript} 
\label{sec:JavaScript}

JavaScript es un lenguaje de programación interpretado, no necesita ser compilado para poder ejecutarse. Es orientado a objetos y eventos. JavaScript se creó para funcionar en un entorno limitado, es decir, el código JavaScript no puede acceder a los recursos del propio ordenador. A raíz de esto, los navegadores también definieron sus propias normas de seguridad, las cuáles determinan que un \emph{script} no puede establecer conexión con páginas que pertenezcan a diferentes dominios. 

Su nombre puede indicar que tiene relación con Java pero la realidad es muy distinta, ya que tanto la semántica como los propósitos son diferentes.
Está basado en prototipos en vez de usar clases, que simulan muchas de las características que tienen las clases en los lenguajes de programación orientados a objetos como, por ejemplo, la herencia. 

Unas de las principales características que lo difiere de otros lenguajes es el ámbito de las variables. En JavaScript, este ámbito es la función donde han sido declaradas y no el bloque en el cuál se declaran. Con la versión 6 se introdujo esta mejora, permitiendo que la variable fuese usada en el bloque,siempre y cuando se definiese utilizando el término $let$. 
 
Es un lenguaje imperativo y estructurado. También es débilmente tipado y dinámico, es decir, una misma variable puede adoptar dos tipos de datos diferentes en distintos momentos, sin tener que redefinir la variable. Está formado en su totalidad por objetos, puediéndose modificar las propiedades de dichos objetos en tiempo de ejecución, dotándolo así del dinamismo que lo define. 

Es un lenguaje rápido y ligero, por lo que se convierte en uno de los lenguajes más usados en el mundo del desarrollo de aplicaciones web. Su uso, principalmente, está en el lado del cliente, pero con la aparición de tecnologías como Node.js, el uso de JavaScript en el lado del servidor está sufriendo un repunte significativo. El hecho de ser un lenguaje multiplaforma, que permite utilizarse en Windows, Linux, Mac, así como en cualquier navegador, hace que aumente su popularidad y su uso. 

Surgió de la necesidad de los desarrolladores de crear páginas web complejas y dinámicas, ya que HTML únicamente permitía crear documentos web estáticos. Fue desarrollado por Brendan Eich de la compañía Netscape y su primer nombre fue Mocha. Poco tiempo después, cambiaría su nombre original y pasaría a llamarse LiveScript. En el año 1995, Netscape y SUN MicroSystems (creadores del lenguaje Java) reintroducirían el lenguaje en el mundo de la programación, como JavaScript. En el año 1997 se adopta como un estándar ECMA, denominándose ECMAScript. Desde entonces ha ido evolucionando y mejorando, creándose bibliotecas y \emph{frameworks} que facilitan la programación. En el año 2015, se publicó ECMAScript 2015 o JavaScript 6, introduciendo características propias de las clases utilizadas en la programación orientada a objetos. La última versión hasta el momento es la versión 8, segunda versión que tiene un proceso de desarrollo abierto. 


\section{TypeScript} 
\label{sec:TypeScript}

TypeScript~\cite{typescript} es un lenguaje de programación de alto nivel orientado a objetos, de código abierto y libre. 

Su desarrollo estuvo a cargo de Microsoft, y en él participó Anders Helsberg (diseñador y creador de C-Sharp, Delphi o Turbo Pascal). Surgió de la necesidad de los desarrolladores de crear aplicaciones robustas y de gran tamaño que con JavaScript no se podían mantener debido a su escasa escalabilidad. 

Su uso está permitido tanto en el lado del servidor con Node.js, como en el lado del cliente con Angular 2, \emph{framework} de JavaScript.

TypeScript es un lenguaje escrito encima de otro lenguaje, por lo que comúnmente se dice que es un superconjunto de JavaScript. Esto significa que TypeScript se compila a JavaScript, permitiendo que cualquier código desarrollado en JavaScript funcione sin tener que modificar el código ni la aplicación. Mejora y arregla algunos problemas que tiene JavaScript y es por ello, que pone a disposición de los desarrolladores las funcionalidades disponibles en JavaScript ES6 y JavaScript ES7. Añade objetos basados en clase, facilitando la programación orientada a objetos. En su código se puede incluir ficheros de definición que contienen información de las bibliotecas JavaScript. Además, incluye un tipado estático. El poder definir variables y funciones tipadas sin perder la esencia de JavaScript ayuda al desarrollador a evitar errores en tiempo de ejecución. %Los tipos admitidos por TypeScript son: String, Number, Boolean, Array, Tuple (tipo de dato similar al Array pero con un número fijo de elementos), Enum, Any (la variable o función puede ser de cualquier tipo), Void, Never (tipo de datos que nunca se producen). 

Se publicó por primera vez en el año 2012 y, actualmente, se encuentra en la versión 2.0, la cual introduce numerosas características con respecto a la primera versión, entre las que destaca la capacidad de evitar la asignación de variables con un valor nulo. %Aunque al principio solo existía un IDE (Microsft Visual Estudio) con TypeScript como lenguaje de programación, ahora hay numerosos editores de texto que lo incluyen como lenguaje de progración. Entre estos editores destacan Sublime Text, WebStorm, Visual Studio Code. 

Su compilador fue desarrollado en TypeScript, compilado a JavaScript y con licencia Apache 2. 


\section{Bootstrap 4} 
\label{sec:Bootstrap 4}

Bootstrap 4~\cite{bootstrap} es la versión más actual y estable de Bootstrap. Es el \emph{framework} más popular de CSS. Se trata de un conjunto de herramientas que permite a los desarrolladores mejorar el aspecto visual de los documentos HTML y de las aplicaciones web de manera rápida y sencilla. 

Su nombre original fue Blueprint, fue creado y diseñado por Matt Otto para la compañía Twitter como herramienta de trabajo de uso interno. En el año 2011, Twitter lo publica con la licencia de software libre MIT y pasa a ser de código abierto. 

El uso de este \emph{framework} en las aplicaciones web permite generar diseños que se adaptan dinámicamente a las diferentes resoluciones de pantalla y a los distintos dispositivos, favoreciendo el diseño \emph{responsive}. Para ello, Bootstrap dispone de un sistema de cuadrilla o rejilla estándar de 940 píxeles, pero dispone de cuatro variaciones de tamaño para adaptarse a los distintos dispositivos. Estas cuatro variaciones son $sm$, $md$, $lg$ y $xl$.

Es modular y consiste en un conjunto de hojas de estilo LESS que combinado con plantillas HTML y con extensiones JavaScript implementan los diferentes componentes de Bootstrap. 

Incluye los elementos más usados en los documentos HTML, como son formularios, barras de progreso y de navegación, cuadros, mensajes de alertas o botones con características especiales entre otros. Todos ellos tienen un estilo predefinido, pero que se puede modificar de manera sencilla. 

Para usar Bootstrap en las aplicaciones web es necesario incluir en el documento HTML la hoja de estilo de Bootstrap CSS. De la misma forma, si se quiere utilizar algunos de los componentes JavaScript predefinidos de Bootstrap se debe incluir la biblioteca JQuery de JavaScript. 

La versión 4 significa una mejora en diversos componentes permitiendo un diseño más \emph{responsive}. Se han modificado componentes como la navegación, que incluye la nueva clase $flexbox$. Se ha creado un nuevo componente Card que sustituye a los componente Wells, Panlles y Thumbnails. Se han modificado los elementos de paginación y las modales. Y se incorpora el componente Grid. Además, de estas significativas mejoras, se han incluido numerosas clases de uso común. 

Es compatible con todos los navegadores modernos, Firefox, Chrome, Safari, Opera, EDGE, Internet Explorer 10, pero no es compatible con las versiones anteriores a Internet Explorer 10.

\section{Angular} 
\label{sec:Angular}

Angular~\cite{angular} es un \emph{framework} de código abierto diseñado por Google. Permite crear aplicaciones web de una sola página, lo que se denomina SPA (Single Page Application). Utiliza TypeScript y HTML para el desarrollo de las aplicaciones web. 

Angular permite separar el \emph{frontend} del \emph{backend} y sigue un modelo MVC (Modelo-Vista-Controlador), arquitectura de software que separa los datos de la aplicación, la interfaz de usuario y la lógica de control en tres componentes distintos. Además, Angular dota a las aplicaciones de escalabilidad, ya que mantiene el código ordenado. De esta forma, las modificaciones y las actualizaciones de las aplicaciones son rápidas y sencillas. 

Una de las principales ventajas de este \emph{framework} y de las páginas SPA es la velocidad de carga entre las diferentes vistas de la aplicación. Cuando se cambia de vista no se recarga la página si no que éstas se cargan de manera dinámica, rápida y reactiva. 

La arquitectura de una aplicación Angular se basa en clases de 4 tipos distintos (módulos, componentes, servicios y directivas). Estas clases se identifican a través de decoradores, los cuales permiten cargar los metadatos necesarios, que determinan a Angular como debe usar dichas clases. 

\textbf{Módulos}.

Los módulos suministran el contexto de compilación de los componentes, es decir, es aquí donde se definen los diferentes componentes que va a formar la aplicación, las dependencias, las clases que actúan como servicios en la aplicación y las rutas de navegación que establecen las vistas de la aplicación. 

Toda aplicación angular tiene un módulo principal, que es el raíz. Este módulo suele recibir el nombre de AppModule y es el que inicia el sistema de arranque de la aplicación. 

Al igual que en JavaScript, los módulos de Angular permiten importar y exportar funcionalidades proporcionadas por otros módulos, por lo que una aplicación puede tener más de un módulo, siendo cada uno de ellos independiente. La manera en que se organizan estos módulos ayuda a la realización de aplicaciones más complejas y a la reutilización de código. Además, permite que la carga inicial sea mínima, ya que cada módulo se carga a petición, es decir, cuando se va a utilizar. 

\textbf{Componentes}. 

Las aplicaciones Angular tienen un componente que es nexo de unión entre los diferentes componentes que forman la aplicación y el modelo de objeto del documento de la página (DOM). Los componentes son los que tienen la lógica y los datos de la aplicación. Son los que controlan las diferentes plantillas HTML que se cargan cuando se modifican las URLs dentro de la aplicación. Estas plantillas HTML son las vistas que forman la interfaz de usuario.

De la misma forma que las aplicaciones diseñadas con Angular pueden tener más de un módulo, también pueden tener subcomponentes, que se pueden relacionar entre sí mediante dos tipos de vinculación de datos, eventos y propiedades. A través de los eventos, la aplicación responde a las entradas del usuario actualizando los datos. A través de las propiedades, se envían valores calculados de los datos de la aplicación a los HTMLs que forman las vistas. Esta vinculación de datos se puede producir en ambas direcciones, por tanto, igual que los datos de la aplicación pueden modificar los HTMLs, los cambios en el DOM pueden modificar los datos de la aplicación.

El decorador @Component es el que determina que una clase actúe como un componente. 

\textbf{Servicios}

Los servicios son clases en las que se definen datos o funcionalidades generales que no están asociadas a una determinada vista. Son usados para compartir datos y operaciones entre componentes. También es donde se suele realizar toda la operativa de las peticiones a la API de las aplicaciones. Deben llevar el decorador @Injectable, pues es el que permite obtener los metadatos necesarios para que otras clases puedan inyectar sus dependencias. 

\textbf{Directivas}

Las directivas son clases en las que se definen los términos claves que se usan en las plantillas. Cuando se carga una vista, Angular procesa estos términos clave que modifican el HTML y el DOM de la aplicación. Por tanto, una plantilla, además de utilizar HTML para definir la vista, usa marcas propias de angular que son estas directivas. 

Existen dos clases de directivas: (i) las de atributo, que modifican el comportamiento del componente, y (ii) las estructurales, que únicamente modifican la apariencia. 

Angular dispone de un enrutador, módulo que contiene un servicio para definir las rutas de navegación de la aplicación. Este módulo se ajusta a las convenciones de los navegadores. Es decir, tanto si se pone la URL en la barra de direcciones, como si se pincha un enlace en la aplicación, como si se hace clic en el botón de retroceso o avance, se navega a la página correspondiente. El enrutador es el que muestra u oculta una vista. Cada vez que se modifica la URL, el enrutador se encarga de añadir la ruta en el historial del navegador, de ahí que los botones de retroceso y avance funcionen. Cada ruta de navegación está asociado a un componente. 

Angular dispone de varias versiones, aportando todas ellas mejoras en dicho \emph{framework}. La primera versión de Angular, se conoce como AngularJS, y es la más distinta a las demás. El resto son actualizaciones de Angular 2. Cuando se definió la segunda versión se decidió modificar el nombre del \emph{framework} y dejarlo como Angular. La última versión estable es la versión 8.

\subsection{Angular CLI} 
\label{sec:Angular CLI}

Angular CLI (Command Line Interface)~\cite{angular:cli} es una herramienta de línea de instrucciones creada por el equipo de Angular. Es muy útil a la hora de iniciar una aplicación web diseñada con Angular, ya que con una sola instrucción, se genera el esqueleto de carpetas y archivos necesarios de la aplicación. Además, contiene herramientas predefinidas que ayudan al desarrollo y mantenimiento de este tipo de aplicaciones. Al crear una aplicación web con Angular CLI, dentro de la estructura de archivos, se crea un archivo de configuración, en el cual se añaden las dependencias necesarias para que la aplicación web compile y ejecute. Este archivo de configuración se va modificando conforme se van creando los componentes, servicios o directivas. Para ello, Angular CLI tiene instrucciones que permiten crear estas clases de manera sencilla, creando los distintos archivos que conforman un componente, un servicio o una directiva. Entre las herramientas predefinidas destaca el compilador, el sistema de \emph{testing} y el servidor web. 

\subsection{Angular Material} 
\label{sec:Angular Material}

Angular Material~\cite{angular:material} es una biblioteca creada por Google para las aplicaciones web desarrolladas con Angular. Al igual que Bootstrap, ayuda a diseñar aplicaciones web atractivas, con estilos y formas únicas, ya que contiene multitud de componentes con estilos prefijados. Estos componentes permiten a las aplicaciones web ser rápidas, consistentes y versátiles. Además, con el uso de esta biblioteca las aplicaciones web se adaptan mejor a la mayoría de resoluciones de pantalla y de dispositivos, facilitando el diseño \emph{responsive} de las aplicaciones. También, con su uso se crean aplicaciones web accesibles, ya que los componentes cumplen con los estándares de accesibilidad. Además, esta biblioteca facilita la internacionalización de la aplicación, puesto que permite la utilización de diferentes idiomas. Angular Material es compatible con todos los navegadores modernos. 

\subsection{Angular Editor} 
\label{sec:Angular Editor}

Angular Editor es un componente de Angular~\cite{angular-editor}, que permite escribir texto con formato y estilo propio dentro de un documento HTML. El estilo y el formato lo determina el usuario. El componente transforma el texto escrito, con el formato y el estilo definido, al lenguaje HTML visualizándose en pantalla conforme el usuario determina. Angular Editor es compatible únicamente con las últimas versiones de Angular (de Angular 6 en adelante). 

\section{Node.js} 
\label{sec:nodejs}
Node.js~\cite{node} fue creado en 2009 por Ryan Dahl como sistema de desarrollo de aplicaciones red escalables. Se trata de un entorno de ejecución orientado a eventos asíncronos que utiliza el motor V8 de Google, desarrollado en C++ y de código abierto, para interpretar el código JavaScript, del mismo modo que hace el navegador Chrome. 

Se basa en sistemas como Event Machine de Ruby y Twisted de Python. Arranca cuando se ejecuta el \emph{script} de entrada al bucle de inicio de eventos y finaliza cuando no hay más devoluciones de llamadas \emph{callbacks}, utilizando así un único hilo. De este modo, cada nuevo evento se añade al bucle de eventos que se ejecuta al inicio, evitando el bloqueo de procesos que se produce en los sistemas de concurrencias basados en la utilización de hilos de los sistemas operativos. Estos procesos usan un hilo por cada conexión provocando la ineficiencia de los recursos utilizados. A pesar de que Node.js esté pensado para usar un único hilo se pueden crear hilos diferentes o subprocesos a través de APIs propias de Node.js como API\_child.process.fork(). 

Por otro lado, Node.js es un buen aliado para desarrollar aplicaciones web, ya que a la hora de implementar el protocolo HTTP para Node.js se pensó tanto en la latencia de transmisión como en la transmisión por \emph{streaming} de datos. 


\section{Npm} 
\label{sec:Npm}
\textit{npm}~\cite{NPM} es el sistema de administración de paquetes del entorno de ejecución de Node.js. Contiene un cliente con el que, ejecutando una línea de instrucciones, se instalan los paquetes necesarios para el funcionamiento de los proyectos Node.js. Además, contiene una biblioteca o base de datos con más de 477.000 paquetes disponibles para usarse. Todos estos paquetes están guardados con formato CommonsJs y contienen un archivo para almacenar metadatos con formato JSON. Fue desarrollado por Isaac Z. Schlueter y se desarrolló por completo en JavaScript.

Al instalar un paquete a través de \textit{npm}, se instala bajo el directorio del proyecto \slash .node\_modules. Permite instalar con una única instrucción todas las dependencias del proyecto, siempre y cuando se ejecute la instrucción en la raíz del proyecto. \textit{npm} utiliza el archivo con formato JSON, denominado \emph{package.json}, para guardar todos los metadatos relevantes a los módulos, paquetes y dependencias del proyecto. En el archivo \emph{package.json} se guardan las versiones compatibles para los diferentes módulos, permitiendo hacer un versionado del módulo instalado. Gracias a esto, \textit{npm} hace que la instalación de proyectos Node.js descargados de Git sea sencilla.


\section{Express.js} 
\label{sec:Express.js}

Express~\cite{express} es el \emph{framework} más usado para aplicaciones desarrollas con Node.js. Se trata de un \emph{framework} flexible, rápido, ligero y minimalista. Pero, a pesar de ello, existen numerosos plugins o \emph{middlewares} compatibles con Express. Estos plugins permiten resolver los problemas que pueden surgir a la hora de implementar aplicaciones con Express. Por todo esto, Express sirve de base de otros muchos \emph{frameworks} de Node.js. 

Express permite:

\begin{itemize}
	\item Crear aplicaciones Node.js de manera sencilla y rápida, ya que proporciona el esqueleto de las aplicaciones. 

	\item Modificar ajustes de la aplicación como la localización de las plantillas que se van a utilizar o el puerto en el que se va a ejecutar.

	\item El uso de cualquier base de datos, siempre y cuando la base de datos esté soportada por Node.

	\item La gestión de cookies, usuarios y sesiones a través de su \emph{middleware}. 

	\item Configurar y establecer las rutas entre el \emph{frontend} y la base de datos. 

	\item Mejorar las funcionalidades HTTP que tiene Node.js y que están basadas en Connect. Existen métodos que determinan la función a usar indicando únicamente el verbo de la petición HTTP. 

\end{itemize}

\section{Nodemon} 
\label{sec:Nodemon}
Nodemon~\cite{nodemon} es una herramienta que permite a los desarrolladores de Node.js implementar sus aplicaciones de manera más sencilla, ya que amplía y mejora funcionalidades propias de Node.js.

Cuando se programa en Node.js, los cambios realizados en el código fuente no se ven reflejados inmediatamente, hasta que no se reinicia el servidor de Node.js no se actualiza la aplicación, por lo que cada vez que se prueba un cambio, habría que parar y arrancar el servidor, ralentizando el desarrollo de los proyectos. Nodemon reinicia de manera automática el servidor cada vez que detecta un cambio en el código fuente, solucionando el inconveniente anterior. Los cambios se ven reflejados en la aplicación inmediatamente, permitiendo programar y probar nuevas funcionalidades sin demoras. 

\section{MongoDB} 
\label{sec:MongoDB}
MongoDB~\cite{mongodb} es una base de datos no relacional, una base de datos NoSQL, que se basa en documentos para guardar la información. 

Es una base de datos gratuita y multiplataforma (Linux, Windows, Os X y Solaris). Las distintas versiones se lanzaban bajo la licencia AGPL, pero a partir de octubre de 2018, se publican bajo la licencia pública SSPL, aunque tiene una línea comercial que contiene características más avanzadas.

A diferencia de las bases de datos relacionales, MongoDB almacena sus datos en documentos y no en tablas. Estos documentos son de esquemas libres, lo que quiere decir que cada entrada puede tener una estructura de datos distinta, con campos que no se tienen porque repetir en otro registro. Por eso, MongoDB tiene mayor flexibilidad y escalabilidad que las bases de datos relacionales. Los documentos se guardan en formato BSON (Binary JSON), lo que permite guardar índices de array, longitudes de campos y datos relevantes, que hacen las búsquedas más rápidas y eficientes. A pesar de que se almacenan en BSON, los desarrolladores siempre trabajarán con documentos JSON. 

Los documentos se agrupan en colecciones y estas colecciones son lo que serían las tablas en las bases de datos relacionales. 

MongoDB permite indexar cualquier atributo. Por defecto, el índice tiene un formato similar a un valor UUID hexadecimal. Está formado por una semilla basada en la MAC de la interfaz de la red de la máquina y por una marca de tiempo, que ocupa las primeras posiciones del índice. Gracias a esta marca de tiempo, los datos se ordenan por orden de creación. Todos los documentos tienen un índice, ya que es el único campo obligatorio dentro de un documento MongoDB. 

MongoDB permite realizar: 
\begin{itemize}
	\item Consultas \emph{ad-hoc}, es decir, se puede realizar búsqueda de datos a través de campos, de rangos o a través de expresiones regulares. Estas consultas nos pueden devolver un dato concreto o pueden devolver el documento entero. 
	\item Balanceo de carga, para ello realiza una partición horizontal de los datos. Es el desarrollador quien decide cómo van a ser distribuidos los diferentes datos. Para llevar a cabo este balanceo de carga, MongoDB puede ejecutarse en diferentes servidores. 
	\item Almacenamiento de archivos. 
	\item Operaciones similares al $Group By$ de SQL, a través de agregaciones. Estas agregaciones se implementan como pipeline en el que se van transformando los datos a través de etapas hasta conseguir el dato deseado. Contiene una operación MapReduce que se suele utilizar en estas agregaciones. 
	\item Consultas a través del lenguaje JavaScript.
\end{itemize}

Como desventajas, MongoDB únicamente puede realizar operaciones concurrentes de escritura entre documentos distintos, ya que cada vez que se realiza una operación de escritura se bloquea el documento. Y, además, puede tener problemas de rendimiento si los datos superan los 100GB. 

\section{Mongoose} 
\label{sec:Mongoose}
Mongoose~\cite{mongoose} es un ODM (Object Document Mapping) de MongoDB, es decir, sirve para mapear objetos de JavaScript a documentos propios de MongoDB. 

Es una biblioteca de JavaScript que se instala a través de una única instrucción \textit{npm} en los proyectos que utilizan Node.js y MongoDB. 

Para mapear los objetos a documentos, lo que hace es crear esquemas con datos fuertemente tipados. Estos esquemas se traducen en un modelo Mongoose, y es este modelo Mongoose el que se traduce en el documento MongoDB. 

Contiene una infinidad de funciones para realizar búsqueda de datos, validación de datos, guardado y eliminado de datos, entre otras. Todas estas funciones se basan en las funciones más comunes que Mongo tiene para realizar estas operaciones. 

Permite crear esquemas muy flexibles, de tal forma que se puede organizar la información de diferente manera, según convenga al desarrollador. Tanto es así, que permite crear esquemas con referencias a otros esquemas, asemejándose de esta forma, a lo que sería una relación entre tablas de una base de datos relacional como, por ejemplo, MySQL.


\section{Bcryptjs} 
\label{sec:bcryptjs}
Bcrypt~\cite{bcryptjs} es una biblioteca que se usa para el cifrado de contraseñas y datos importantes. Fue creada por Niels Provos y David Maxieres y está desarrollada con JavaScript. 

Utiliza un valor aleatorio, denominado \emph{salt}, para la generación del \emph{hash} del dato que se desea cifrar. Este valor se guarda con el \emph{hash} en la base de datos. Por eso, para el mismo valor se obtiene diferentes \emph{hashes}. Gracias a esto, se evitan los ataques de fuerza bruta o los ataques denominados Rainbow table (tablas de textos y sus \emph{hash} asociados). Bcrypt permite elegir el valor del SaltRound, ya que a mayor valor numérico del \emph{salt} mayor seguridad, pero a mayor seguridad mayor coste de tiempo a la hora de cifrar los datos. Por lo tanto, lo idóneo es elegir un \emph{salt} lo suficientemente grande para que no se pueda obtener el dato cifrado por fuerza bruta pero no lo suficientemente alto como para que el procesamiento se demore mucho tiempo. Por defecto, Bcrypt pone un \emph{salt} de 10, un valor intermedio para que no se produzcan los dos problemas principales. 

Bcrypt permite realizar comparaciones entre valores. Para realizar la comparación no descifra el dato a comparar, como se hace en otros sistemas, si no que cifra el valor con el \emph{salt} del dato cifrado. 

\section{Passport.js} 
\label{sec:Passport.js}
Passport~\cite{passport} es un \emph{middleware} que permite la autenticación en aplicaciones Node.js. Es de código abierto. Se puede incorporar en cualquier aplicación basada en Express, ya que trabaja en conjunto con Express y Connect. Permite gestionar y administrar las sesiones de los usuarios. Las características que definen Passport son: 
\begin{itemize}
	\item Tiene numerosas estrategias de autenticación. Por ejemplo, permite autenticarse utilizando bases de datos, en las que se almacenan las sesiones o puede autenticarse con el inicio de sesión único de OpenID y OAuth, usados por ejemplo, en Facebook. 
	\item Permite desarrollar nuevas estrategias de autenticación. 
	\item Permite usar sesiones persistentes. 
	\item Gestiona el proceso de autenticación indicando si ha sido satisfactoria. 
\end{itemize}


\section{Git} 
\label{sec:Git}

Git~\cite{git} es un software de control de versiones. Fue diseñado por Linus Torvalds. Es un software libre que se distribuye a través de la versión 2.0 de la licencia GNU GPL. 

Git permite el trabajo en equipo mediante su sistema de ramas, que permite el desarrollo no lineal de los proyectos. En cada rama se puede trabajar sobre una funcionalidad distinta, agilizando de esta forma el desarrollo del proyecto y haciendo que el trabajo en equipo sea más sencillo y óptimo. Además, permite gestionar de manera eficiente aplicaciones y proyectos de gran envergadura. 

Los cambios en los proyectos se realizan de manera inmediata, ya que cada desarrollador tiene una copia en local (en su equipo) del proyecto. Esto permite navegar por el historial de cambios sin necesidad de conectarse a un servidor. Es decir, se puede trabajar en local hasta finalizar una tarea y, posteriormente, subirlo al repositorio. Así, todo el equipo obtiene el cambio en su proyecto local. 

Cuando se usa Git en un equipo de trabajo se definen flujos que determinan como se va a realizar el desarrollo del proyecto. Es habitual que exista una rama \emph{master}, que será la que se despliegue en producción. De esta rama \emph{master} se obtiene una nueva rama, por ejemplo \emph{develop}. En esta rama se añaden los cambios y las funcionales nuevas. Se mezcla con la rama \emph{master} una vez testeados los cambios. Para funcionalidades específicas, se crean ramas que se obtienen de la \emph{develop}, denominándose por ejemplo \emph{features}. De esta forma, se permite el desarrollo en paralelo de los distintos integrantes del grupo. Una vez que la funcionalidad esté finalizada y probada se junta con la rama \emph{develop}. Cuando el resto del equipo actualiza su rama \emph{develop}, obtienen los cambios de las nuevas funcionalidades sin que su trabajo se vea afectado. Cuando hay un error en producción que deber ser solucionado inmediatamente, se crea una rama a partir de la \emph{master}, llamada \emph{hotfix}, donde se desarrollan las soluciones al error. Una vez implementada la solución al error, se mezcla con la rama \emph{master}. 

\section{Visual Studio Code} 
\label{sec:Visual Studio Code}

Visual Studio Code es un editor de código fuente, lanzado en 2015 por Microsoft. Se trata de un editor multiplataforma, pudiéndose instalar en Windows, Linux y MacOS.

Soporta una gran cantidad de lenguajes de programación. El resaltado de sintaxis, la capacidad de finalización del código que se escribe, la refactorización del código, el modo depuración, así como la integración con Git facilita el desarrollo de aplicaciones. 

Para hacer más atractiva su interfaz y para facilitar su uso, permite personalizar los temas del editor y los atajos del teclado. 

Es un editor de código abierto bajo licencia de software libre MIT, lo que quiere decir que se puede descargar de GitHub y realizar cualquier modificación en su código. Se basa en Electron, \emph{framework} utilizado para el desarrollo de aplicaciones de escritorio usando tecnologías web, utiliza Chromium para el motor gráfico y Node.js para ejecutar JavaScript.

\section{Mongo Compass} 
\label{sec:Mongo Compass}
Mongo Compass~\cite{mongo:Compass} es una herramienta gráfica, multiplataforma (Linux, Mac y Windows), que permite a los desarrolladores interactuar con un base de datos MongoDB. Las principales ventajas que tiene su uso son: 
\begin{itemize}
	\item Permite analizar los esquemas, visualizando la estructura de sus documentos, el tipo y los rangos de los campos de dichos documentos.
	\item Permite gestionar de manera sencilla los índices. 
	\item Se pueden realizar todas las operaciones CRUD\footnote{Acrónimo de ``Crear, Leer, Actualizar y Borrar'' (del original en inglés: Create, Read, Update and Delete).} de manera visual. De la misma forma, se pueden realizar búsquedas o aplicar filtros para encontrar datos dentro de los documentos del esquema. 
	\item Ayuda a resolver problemas de rendimientos, ya que se pueden obtener análisis y gráficos de lo que tarda una \emph{query} en ejecutarse. 
	\item Se pueden crear agregaciones de manera intuitiva y sencilla, gracias a los esqueletos de código y al autocompletado. Estas agregaciones se exportan a código fuente para que se incorporen dentro del código de la aplicación que usa MongoDB.

\end{itemize}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% DISEÑO E IMPLEMENTACIÓN %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\cleardoublepage
\chapter{Diseño e implementación}

\section{Arquitectura general} 
\label{sec:arquitectura}

La aplicación implementada en este trabajo tiene una arquitectura $Three-Tier$, es decir, una arquitectura de tres niveles. El primer nivel de esta arquitectura es la capa de presentación o cliente. Este nivel está compuesto por las diferentes vistas de la aplicación que forman la interfaz de usuario. Es el encargado de recoger la información que produce el usuario al interactuar en la aplicación y el que envía, a través de peticiones, la información al segundo nivel. El segundo nivel es el servidor, donde se encuentra la lógica de negocio. Se encarga de recibir todas las peticiones de usuario enviadas por el cliente y de su posterior respuesta. Es el único nivel que se comunica con el resto, puesto que, también puede comunicarse con el tercer nivel, acceso a base de datos o servidor de base de datos. Este tercer nivel es el que maneja la información. En la figura~\ref{fig:arquitecturaThreeTier} se representa un ejemplo de este tipo de arquitectura. 

\begin{figure}[H]
  \centering
  \includegraphics[width=15cm, keepaspectratio]{img/arquitectura-ThreeTier.png}
  \caption{Ejemplo arquitectura Three-Tier.}
  \label{fig:arquitecturaThreeTier}
\end{figure}

Existen distintos tipos de arquitectura $Three-Tier$. La escogida para esta aplicación es la denominada $MEAN$. Este tipo de arquitectura se denomina así porque utiliza MongoDB, Express, Angular y Node.js para el desarrollo de las aplicaciones. En la figura~\ref{fig:arquitecturaMean} se puede observar como es la comunicación entre el cliente y el servidor en una arquitectura de tipo MEAN.

\begin{figure}[H]
  \centering
  \includegraphics[width=10cm]{img/Arquitectura_mean.png}
  \caption{Ejemplo arquitectura de tipo MEAN.}
  \label{fig:arquitecturaMean}
\end{figure}


Para la implementación del cliente se ha usado Angular, ya que permitía crear una aplicación Single-Page, haciendo uso del modelo-vista-controlador (MVC). Este tipo de aplicaciones se caracterizan por la rapidez y la fluidez de navegación, ya que no es necesario recargar la página cada vez que se cambia de vista. Angular utiliza TypeScript como lenguaje de programación, por lo que el cliente está programado con esta tecnología, además, de usar HTML5, CSS3 y Bootstrap. El cliente utiliza el servidor que proporciona Angular CLI para servir los recursos.


El servidor se ha implementado usando Node.js y Express, consiguiendo así, crear una aplicación rápida y escalable. Se ha programado utilizando JavaScript. Por su parte, el servidor se encuentra alojado en el servidor proporcionado por Node.js.

Para establecer la comunicación entre el cliente (servido por Angular CLI) y el servidor (servido por Node.js) se ha recurrido a la utilización de un  \emph{proxy}. En JavaScript, cuando se hacen peticiones a un dominio distinto al del origen del \emph{script}, como es el caso, surge el problema de Cross Domain, el cual impide que se establezca la conexión entre el cliente y el servidor. En el caso de la aplicación, el  \emph{proxy} actúa de intermediario reenviando todo el tráfico que recibe Angular CLI en el contexto $\slash nevado$ al servidor e intercepta las respuestas que el servidor envía al cliente. Con Angular CLI se configura de manera sencilla, ya que para configurarlo solo se necesita un fichero de configuración y ejecutar su servidor a través de la instrucción: \emph{ng-serve --proxy-config proxy.conf.json}. 

La aplicación necesita una base de datos para almacenar tanto los datos de los clientes, como los datos de los productos, facturas y pedidos. Se ha utilizado una base de datos no relacional, concretamente MongoDB. 

 



\section{Modelo de la base de datos} 
\label{sec:baseDatos}

El gestor de base de datos utilizado es MongoDB, que es una base de datos no relacional. Se ha utilizado este tipo de base de datos por la flexibilidad que proporciona a la hora de trabajar con documentos. Además, como se ha comentado en la sección~\ref{sec:MongoDB}, los documentos almacenados no tienen porque tener las mismas propiedades, lo que resulta muy útil para el almacenamiento de los productos, ya que cada producto tiene propiedades diferentes. Están indicadas en aplicaciones en las que el volumen de datos crece constantemente. En una tienda \emph{online}, tanto el número de usuarios como el número de pedidos está en constante crecimiento. El formato de los documentos de las distintas colecciones de la base de datos está definido en el subdirectorio modelos del servidor. Las colecciones de la aplicación se describen a continuación: 

\begin{itemize}
	\item \textbf{Usuarios}: Colección donde se almacenan los usuarios registrados de la tienda \emph{online}. Los campos que tienen sus documentos son:
		\begin{itemize}
				\item \textbf{correo}: Dirección de correo electrónico con el que se registra el usuario, debe ser único y siempre debe de estar presente en los documentos guardados. (String).

				\item \textbf{rol}: Perfil del usuario registrado, puede ser cliente o admin. Dependiendo de este perfil se pueden visualizar unas vistas u otras. (String)

				\item \textbf{bloqueado}: Indica si un usuario se ha bloqueado. El administrador de la tienda \emph{online} puede bloquear usuarios en caso de detectar anomalías en su comportamiento. (Boolean)

				\item \textbf{confirmacion}: Indica si un usuario está confirmado. Si el usuario no está confirmado no podrá realizar compras. (Boolean)

				\item \textbf{contrasena}: Contraseña cifrada introducida por el usuario para entrar en su cuenta. Es un campo que siempre debe ir relleno. (String)

				\item \textbf{clientes}: Identificador del usuario en la tabla clientes. Cuando un usuario se registra se crea un documento nuevo en la colección clientes. (ObjectId)

		\end{itemize}

	\item \textbf{Clientes}: Colección donde se almacena la información personal de un usuario registrado. Los campos son:

		\begin{itemize}
				\item \textbf{nombre}: Nombre del usuario registrado. (String)

				\item \textbf{apellidos}: Apellidos del usuario registrado. (String)

				\item \textbf{teléfono}: Teléfono personal donde dirigirse en caso de tener problemas con su pedido. (String)

				\item \textbf{fechaNacimiento}: Fecha de nacimiento del usuario registrado. (String)

				\item \textbf{direccionFactura}: Dirección de facturación. Calle, número, portal, escalera, piso y letra. (String)

				\item \textbf{codigoPostalFactura}: Código postal de la dirección de facturación. (String) 

				\item \textbf{puebloFactura}: Municipio de la dirección de facturación. (String)

				\item \textbf{provinciaFactura}: Provincia de la dirección de facturación. (String)

				\item \textbf{direccionEnvio}: Dirección donde se envía el pedido. Sólo tendrá valor si la dirección de envío es diferente a la dirección de facturación. (String)

				\item \textbf{codigoPostalEnvio}: Código postal de la dirección de envío. Sólo tendrá valor si la dirección de envío es diferente a la dirección de facturación. (String)

				\item \textbf{puebloEnvio}: Municipio de la dirección de envío. Sólo tendrá valor si la dirección de envío es diferente a la dirección de facturación. (String)

				\item \textbf{provinciaEnvio}: Provincia de la dirección de envío. Sólo tendrá valor si la dirección de envío es diferente a la dirección de facturación. (String)

				\item \textbf{pedidos}: Número de pedidos realizados por el usuario en la tienda. (Number)

		\end{itemize}

	\item \textbf{Artículos}: Colección donde se almacena la información de los productos. 

		\begin{itemize}
				\item \textbf{codigoArticulo}: Identificador del artículo. Es único y debe estar presente en todos los documentos guardados. (String)

				\item \textbf{categoria}: Grupo en el que se encuadra el artículo. (String)

				\item \textbf{modelo}: Modelo del artículo. (String)

				\item \textbf{marca}: Marca del artículo. (String)

				\item \textbf{pvpTarifa}: Precio máximo del artículo (Number)

				\item \textbf{pvp}: Precio del artículo con IVA. (Number) 

				\item \textbf{estado}: Indica si el producto es visible o no en el catálogo. (Boolean)

				\item \textbf{stock}: Existencias del artículo en el almacén. (Number)

				\item \textbf{imagen}: Ubicación donde se encuentra la foto del producto en el servidor. (String)

				\item \textbf{características}: Descripción del artículo con las características principales. (String)

				\item \textbf{otros}: Información adicional del artículo. (String)

				\item \textbf{fechaPublicacion}: Fecha en la que se guarda por primera vez el artículo en el sistema. (Date)

				\item \textbf{fechaModificacion}: Fecha en la que algún campo del documento es actualizado. (Date)

				\item \textbf{autor}: Nombre de quien añade el artículo al sistema. (String)

				\item \textbf{ventas}: Número de veces que el producto ha sido comprado. (Number)

				\item \textbf{ofertas}: Identificador del descuento que se le aplica al producto si estuviese en oferta. (ObjectId)

				\item \textbf{envioGratuito}: Indica si el artículo se envía sin ningún coste. (Boolean)

				\item \textbf{estrellas}: Número de estrellas puestas en las reseñas. (Number)

				\item \textbf{usuarios}: Número de usuarios que han escrito una reseña sobre el producto. (Number)

				\item \textbf{comentarios}: Array de identificadores de las reseñas del producto. (ObjectId)

		\end{itemize}

	\item \textbf{Categorías}: Colección donde se almacenan las diferentes categorías donde se agrupan los productos. 

		\begin{itemize}
				\item \textbf{nombre}: Nombre de la categoría. Es único y debe estar presente en todos los documentos. (String)

				\item \textbf{imagen}: Ubicación donde se encuentra la foto en el servidor. (String)

				\item \textbf{categoriaGeneral}: Grupo donde se encuadra la categoría. (String)

		\end{itemize}

	\item \textbf{Marcas}: Colección donde se almacenan las marcas de los artículos. 

		\begin{itemize}
				\item \textbf{nombre}: Nombre de la marca. Es único y debe estar presente en todos los documentos. (String)

				\item \textbf{imagen}: Ubicación donde se encuentra el logo de la marca en el servidor. (String)

		\end{itemize}

	\item \textbf{Ofertas}: Colección donde se almacenan las ofertas disponibles en la tienda \emph{online}. 

		\begin{itemize}
				\item \textbf{idOferta}: Identificador de la oferta, es único y siempre debe estar relleno. (String)

				\item \textbf{descuento}: Descuento que se aplica en la oferta. Siempre en \% (Number)

				\item \textbf{fechaInicio}: Fecha en la que se empieza a aplicar la oferta. (Date)

				\item \textbf{fechaFin}: Fecha límite de la oferta. (Date)

				\item \textbf{descripcion}: Breve descripción del motivo de la oferta. (String)

		\end{itemize}

	\item \textbf{Comentarios}: Colección donde se almacenan las reseñas escritas por los usuarios. 

		\begin{itemize}
				\item \textbf{calificacionGeneral}: Puntación general que se le otorga al producto. (Number)

				\item \textbf{titulo}: Título de la reseña (String)

				\item \textbf{comentario}: Valoración del usuario al producto. (String)

				\item \textbf{recomendacion}: Indica si el usuario aconsejaría comprar el producto. (Boolean)

				\item \textbf{calidadPrecio}: Puntación que se le otorga al producto en cuanto a calidad precio. (Number)

				\item \textbf{alias}: Nombre del usuario que escribe la reseña. (String)

				\item \textbf{email}: Correo del usuario que escribe la reseña. (String)

		\end{itemize}

	\item \textbf{Método de Pago}: Colección donde se almacenan los métodos de pago con los que se pueden pagar los pedidos. 

		\begin{itemize}
				\item \textbf{nombre}: Nombre del método de pago (String)

				\item \textbf{imagen}: Ubicación donde se encuentra el logo del método de pago. (String)

		\end{itemize}

	\item \textbf{Transportes}: Colección donde se almacenan las empresas de transportes utilizadas para el envío de los pedidos. 

		\begin{itemize}
				\item \textbf{nombre}: Nombre de la empresa de transporte. (String)

		\end{itemize}

	\item \textbf{Pedidos}: Colección donde se almacena la información relativa a los pedidos. 

		\begin{itemize}
				\item \textbf{idPedido}: Identificador del pedido, debe ser único. (String)

				\item \textbf{fechaEntrada}: Fecha en la que se realiza el pedido. (Date)

				\item \textbf{fechaEntrega}: Fecha aproximada de la entrega del pedido. (Date)

				\item \textbf{estado}: Indica la situación del pedido: pendiente, preparando, entregado y finalizado. (String)

				\item \textbf{total}: Precio total del pedido. (Number)

				\item \textbf{formasPago}: Método de pago del pedido. (String)

				\item \textbf{cobrado}: Indica si el pedido está pagado o no. (Boolean)

				\item \textbf{usuario}: Identificador del usuario que realizó el pedido. (ObjectId)

				\item \textbf{articulos}: Artículos que contiene el pedido. Array de objetos formados por el identificador del producto y cantidad del producto comprado. (Array)

		\end{itemize}


	\item \textbf{Facturas}: Colección donde se almacena la información relativa a las facturas de los pedidos realizados. 

		\begin{itemize}
				\item \textbf{nFactura}: Identificador de la factura, debe ser único. (String)

				\item \textbf{fecha}: Fecha en la que se crea la factura. (Date)

				\item \textbf{cliente}: Identificador del usuario que realiza la compra. (ObjectId)

				\item \textbf{total}: Precio total de la factura. (Number)

				\item \textbf{formasPago}: Método de pago con el que se paga el pedido. (String)

				\item \textbf{idPedido}: Identificador del pedido asociado a la factura. (String)

				\item \textbf{articulos}: Artículos que contiene el pedido. Array de objetos formados por el identificador del producto y cantidad del producto comprado. (Boolean)

		\end{itemize}

	\item \textbf{Mensajes}: Colección donde se almacenan los mensajes enviados por parte de los usuarios al administrador. 

		\begin{itemize}
				\item \textbf{idUsuario}: Identificador del usuario que escribe el mensaje. (ObjectId)

				\item \textbf{nombreUsuario}: Nombre del usuario que escribe el mensaje. (String)

				\item \textbf{correoUsuario}: Correo del usuario que escribe el mensaje. (String)

				\item \textbf{mensaje}: mensaje que se envía al administrador. (String)

				\item \textbf{leido}: Indica si un mensaje se ha leído o no. (Boolean)

				\item \textbf{fecha}: Fecha en la que se envió el mensaje. (Date)

		\end{itemize}

\end{itemize}

\begin{figure}[H]
  \centering
  \includegraphics[width=14cm]{img/baseRelacional.png}
  \caption{Diseño de la base de datos utilizando una base de datos relacional.}
  \label{fig:baseRelacional}
\end{figure}


\section{Diseño e implementación del servidor} 
\label{sec:Disenioservidor}

El servidor es el encargado de recibir las peticiones del cliente y de su posterior respuesta. Para ello, se ha implementado un API REST. Esta API REST es la encargada de devolver los datos requeridos en cada petición del cliente. El API REST se explica en la sección~\ref{sec:apirest}. Por otro lado, el servidor es el que realiza las peticiones a base de datos para la obtención, el guardado, borrado y actualización de los datos almacenados en ella. 

La implementación del servidor se ha realizado usando Node.js y Express, usado este último para la estructuración de los archivos del servidor y para el enrutamiento de las llamadas a la API REST. Node.js está orientado a eventos asíncronos que se ejecutan en un único hilo, como se explicó en la sección~\ref{sec:nodejs}. Para el manejo de los eventos asíncronos es necesario recurrir a la programación asíncrona y, en este tipo de programación, es común recurrir al uso de los denominados \emph{callbacks}, funciones que ejecutan otra función una vez terminada la operación. Para evitar estos \emph{callbacks} y hacer el código más legible, se ha recurrido al uso de los operadores $async$ y $await$. Estos operadores tienen como finalidad simplificar la manera de programación cuando se programa de manera asíncrona, ya que permiten ejecutar promesas y esperar el resultado sin utilizar $then$ y $catch$, muy usados en JavaScript para este tipo de programación, y que lo único que les diferencia de los \emph{callbacks} es la simplicidad en el código.

\subsection{Estructura del servidor} 
\label{sec:estructuraServidor}

\begin{itemize}

	\item  \textbf{Server.js}: archivo donde se establece el puerto de la conexión de la aplicación y desde el cual se inicia el servidor. Además, carga el archivo \textbf{App.js}, archivo principal del servidor.


	\item \textbf{App.js}: archivo principal del servidor. Es donde se establece la conexión con la base de datos  y donde se configura el \emph{middleware} para servir el API REST y los datos estáticos. 

	\item \textbf{Package.json}: archivo donde se especifican las dependencias de las bibliotecas utilizadas en el servidor y la versión de cada una de ellas. Además, se define el nombre y la descripción de la aplicación. 

	\item \textbf{\slash .node\_modules}: directorio donde están instaladas las bibliotecas usadas en el servidor. Al recurrir a Express para la organización del servidor, muchas de las bibliotecas ya vienen definidas. Pero muchas otras se han instalado por necesidades de la aplicación. Para su instalación se ha usado la instrucción \emph{npm install}.
\end{itemize}

\begin{figure}[H]
  \centering
  \includegraphics[width=12cm, keepaspectratio]{img/estructuraServidor.png}
  \caption{Estructura de los directorios del servidor.}
  \label{fig:estructuraArchivosServidor}
\end{figure}

En la figura~\ref{fig:estructuraArchivosServidor} se puede observar como está organizado el servidor. 

\begin{itemize} 

	\item \textbf{\slash config}: directorio que contiene la configuración del servidor. El archivo \textbf{nevadoServer.properties} contiene los contextos de los distintos \emph{endpoints} usados en el API REST. De este modo, en el caso de cambiar de contexto, únicamente se modificaría en este archivo y no en cada uno de los \emph{endpoints} afectados por la modificación. El archivo \textbf{passport.js} permite la autenticación de los usuarios. Además, permite que únicamente el usuario con rol de administrador pueda acceder a la parte administración de la tienda \emph{online}. 

	\item \textbf{\slash modelos}: directorio que contiene la estructura de los documentos de las colecciones usadas en la base de datos de la aplicación.

	\item \textbf{\slash routes}: directorio en el que se encuentran todos los \emph{endpoints} de la API. Consta de dos subdirectorios, uno para la parte que solo puede ver el administrador de la tienda \emph{online} (\textbf{\slash admin}) y otro para la parte de la tienda \emph{online} que ven los usuarios \textbf{\slash front}. Además, contiene los archivos \textbf{APIREST.JS}, \textbf{APIRESTADMIN.JS}, \textbf{APIRESTORDERS.JS} y \textbf{APIRESTUSER.JS}. Estos archivos son los que determinan a que archivo se ha de dirigir cada contexto del API.

	\item \textbf{\slash services}: contiene la lógica del negocio de la aplicación, es decir, se especifica que se debe hacer en cada llamada a la API. En estos archivos se produce el acceso a la base de datos para el guardado, borrado, búsqueda y actualización de los datos almacenados. Está organizado de la misma forma que el directorio \textbf{\slash routes}, un subdirectorio para la administración y otro para la tienda \emph{online} que ven los usuarios.

	 \item \textbf{\slash utils}: directorio que contiene las funciones genéricas usadas en los diferentes servicios del servidor. Entre algunas funcionalidades, destacan el formateo de fechas, la creación de PDFs y la configuración del correo para poder enviar \emph{emails} a los usuarios de la tienda \emph{online}. 

\end{itemize}


\subsection{API REST de la aplicación} 
\label{sec:apirest}

La API es cada uno de los \emph{endpoints} que tiene la aplicación para que el cliente y el servidor se comuniquen. Se utiliza el protocolo HTTP para establecer estas conexiones, por lo que las operaciones soportadas son GET, POST, PUT y DELETE. La respuesta por parte del servidor a estas llamadas tienen un formato JSON. 

Los \emph{endpoints} de la aplicación implementada en este trabajo son: 

\begin{itemize}
	\item  \textbf{POST \slash nevado\slash auth\slash register}: registra nuevos usuarios en el sistema. Antes de registrarlos, comprueba si existe el \emph{email} en el sistema, en caso de existir manda un error indicando que el usuario está dado de alta. Al mismo tiempo que se crea un registro nuevo en la colección de usuarios, se crea un nuevo registro en la colección de clientes. 

	\item \textbf{POST \slash nevado\slash auth\slash register\slash idUsuario}: Actualiza la información de confirmación del usuario.

	\item \textbf{POST \slash nevado\slash auth\slash login}: Permite el inicio de sesión. Para hacer este inicio de sesión, se comprueba el \emph{email} y la contraseña. Si son erróneas devuelve un error que se muestra en pantalla. 

	\item \textbf{GET \slash nevado\slash auth\slash logout}: Cierra la sesión del usuario. 

	\item \textbf{GET \slash nevado\slash auth\slash forgetPassword\slash email}: Envía un correo al usuario, que ha olvidado la contraseña, con el enlace para restituirla. Antes de envíar el correo se comprueba que el usuario esté registrado en la aplicación. Si no lo está devuelve error y no envía el correo.

	\item \textbf{POST \slash nevado\slash auth\slash forgetPassword\slash idUsuario}: Permite reestablecer la contraseña del usuario. 

	\item \textbf{GET \slash nevado\slash user\slash idUsuario}: Obtiene la información personal de un usuario para mostrarla en pantalla. El usuario tiene que estar autenticado para ver esta información.

	\item \textbf{POST \slash nevado\slash user\slash idUsuario}: Permite actualizar los datos personales de un usuario. Sólo el usuario y el administrador de la aplicación pueden modificar estos datos. 

	\item \textbf{GET \slash nevado\slash orders\slash idUsuario}: Devuelve la lista de pedidos que el usuario ha realizado. El usuario debe haber iniciado sesión en la tienda \emph{online} para ver esta información. 

\end{itemize}

\textbf{API parte de administración de la aplicación}

 La administración es lo que comúnmente se denomina trastienda. Permite gestionar la tienda \emph{online}, es decir, añadir productos, proveedores, ver la lista de clientes y administrar los pedidos que hay. Únicamente puede acceder a esta parte aquellos usuarios que tienen rol de administrador. Para controlar esto, se ha usado $Passport.js$. Passport permite añadir en cada \emph{endpoint} la autenticación del usuario. Esta autenticación será explicada en la sección~\ref{sec:autenticacion}.

\begin{itemize}

	\item \textbf{GET \slash nevado\slash admin}: Muestra la página principal de la parte de administración. 

	\item  \textbf{GET \slash nevado\slash admin\slash orders}: Devuelve la lista de pedidos realizados por los clientes de la tienda \emph{online}. Estos pedidos están ordenados por la fecha de entrada. Se puede aplicar filtros, para que únicamente devuelva los pedidos que se necesitan.

	\item \textbf{GET \slash nevado\slash admin\slash orders\slash export}: Exporta la lista de pedidos realizados por parte de los clientes en formato Excel.

	\item \textbf{POST \slash nevado\slash admin\slash orders\slash idPedido}: Actualiza el estado del pedido. Cuando un cliente finaliza un pedido siempre se crea con estado ``pendiente". El administrador modifica el estado cuando se empieza a preparar para permitir al usuario conocer el estado de su pedido.

	\item \textbf{POST \slash nevado\slash admin\slash orders\slash cobrado\slash idPedido}: Actualiza el campo cobrado de un pedido. Esta opción se ha implementado pensando en los pagos contra-reembolso, ya que estos pagos se realizan en el momento que el cliente ha recibido su producto en casa. 

	\item \textbf{GET \slash nevado\slash admin\slash orders\slash pending}: Devuelve el número de pedidos que están con estado ``pendiente". Este número se muestra en el \emph{header} de la parte de administración, agilizando la preparación de los envíos.

	\item \textbf{GET \slash nevado\slash admin\slash orders\slash products}: Recupera la información de los productos que contiene un pedido. 

	\item \textbf{GET \slash nevado\slash admin\slash invoices}: Devuelve la lista de facturas del sistema. Está ordenada por número de factura y, además, permite aplicar filtros para la búsqueda de facturas concretas. 

	\item \textbf{GET \slash nevado\slash admin\slash invoices\slash export}: Exporta la lista de facturas almacenadas en el sistema en formato Excel.

	\item \textbf{POST \slash nevado\slash admin\slash invoices\slash pedido}: Genera la factura correspondiente a un pedido. La factura siempre se genera al finalizar el pedido, exceptuando cuando el método de pago es contra-reembolso, que se generará a mano. 

	\item \textbf{POST \slash nevado\slash admin\slash invoices\slash products}: Devuelve la información relativa a los productos que contiene la factura de un pedido. 

	\item \textbf{POST \slash nevado\slash admin\slash invoices\slash client}: Devuelve la información que se necesita de un cliente para generar la factura. 

	\item \textbf{POST \slash nevado\slash admin\slash invoices\slash pdf}: Genera el PDF de la factura. 

	\item \textbf{GET \slash nevado\slash admin\slash invoices\slash idFactura}: Comprueba si la factura está generada. Sólo se puede generar una factura por pedido. 

	\item \textbf{GET \slash nevado\slash admin\slash products}: Retorna la lista de productos que tiene la tienda \emph{online}. Permite filtrar los productos por código, marca, categoria, modelo y precio. 

	\item \textbf{GET \slash nevado\slash admin\slash products\slash export}: Exporta la lista de productos de la tienda \emph{online} en formato Excel. 

	\item \textbf{GET \slash nevado\slash admin\slash products\slash idProducto}: Retorna la información de un producto.

	\item \textbf{POST \slash nevado\slash admin\slash products}: Añade un nuevo producto en el sistema.

	\item \textbf{POST \slash nevado\slash admin\slash products\slash idProducto}: Actualiza la información de un producto.

	\item \textbf{DELETE \slash nevado\slash admin\slash products\slash idProducto}: Elimina un producto del catálogo de la tienda \emph{online}.

	\item \textbf{GET \slash nevado\slash admin\slash brands}: Devuelve la lista de marcas registradas en la tienda \emph{online}.

	\item \textbf{GET \slash nevado\slash admin\slash brands\slash export}: Exporta la lista de marcas registradas en la tienda \emph{online} en formato Excel.

	\item \textbf{DELETE \slash nevado\slash admin\slash brands\slash idMarca}: Elimina una marca de la tienda \emph{online}.

	%\item \textbf{GET \slash nevado\slash admin\slash brands\slash products}: Devuelve los productos que tienen una misma marca.

	\item \textbf{POST \slash nevado\slash admin\slash brands}: Añade una nueva marca al registro de la tienda \emph{online}.

	\item \textbf{GET \slash nevado\slash admin\slash categories}: Devuelve la lista de categorías registradas en la tienda \emph{online}.

	\item \textbf{GET \slash nevado\slash admin\slash categories\slash export}: Exporta la lista de categorías registradas en la tienda \emph{online} en formato Excel.

	\item \textbf{DELETE \slash nevado\slash admin\slash categories\slash idCategoría}: Elimina una categoría de la tienda \emph{online}.

	\item \textbf{GET \slash nevado\slash admin\slash categories\slash products}: Devuelve los productos que tienen una misma categoría.

	\item \textbf{POST \slash nevado\slash admin\slash categories}: Añade una nueva categoría al registro de la tienda \emph{online}.

	\item \textbf{GET \slash nevado\slash admin\slash clients}: Devuelve el listado de usuarios registrados en la tienda \emph{online}. Además, permite filtrar el listado por nombre, apellidos, dirección de correo electrónico, DNI y teléfono. 

	\item \textbf{GET \slash nevado\slash admin\slash clients\slash export}: Exporta el listado de usuarios registrados en la tienda \emph{online} en formato Excel. 

	\item \textbf{DELETE \slash nevado\slash admin\slash clients\slash idUsuario}: Elimina un usuario de la aplicación. El usuario registrado puede cancelar su cuenta cuando lo desee a través de un correo electrónico al administrador. El administrador, por la Ley de protección de datos y política de privacidad, deberá borrarlo del registro del cliente.

	\item \textbf{GET \slash nevado\slash admin\slash payments}: Devuelve la lista de métodos de pagos disponibles en la tienda \emph{online}. Se puede filtrar por el nombre del método de pago.

	\item \textbf{POST \slash nevado\slash admin\slash payments}: Añade un nuevo método de pago a la tienda \emph{online}.

	\item \textbf{GET \slash nevado\slash admin\slash payments\slash export}: Exporta la lista de métodos de pagos disponibles en la tienda \emph{online} en formato Excel.

	\item \textbf{DELETE \slash nevado\slash admin\slash payments\slash idPago}: Elimina un método de pago del sistema.

	\item \textbf{GET \slash nevado\slash admin\slash transports}: Devuelve la lista de empresas de transporte que se utilizan para realizar los envíos. Se puede filtrar la lista por el nombre de la empresa.

	\item \textbf{GET \slash nevado\slash admin\slash transports\slash export}: Exporta la lista de empresas de transporte que se utilizan para realizar los envíos en formato Excel.

	\item \textbf{POST \slash nevado\slash admin\slash transports}: Añade una nueva empresa de transporte.

	\item \textbf{DELETE \slash nevado\slash admin\slash transports\slash idEmpresaTransporte}: Elimina una empresa de transporte del sistema. 

	\item \textbf{GET \slash nevado\slash admin\slash offers}: Devuelve la lista de ofertas que están disponibles en la tienda \emph{online}. 

	\item \textbf{POST \slash nevado\slash admin\slash offers}: Añade una nueva oferta. 

	\item \textbf{GET \slash nevado\slash admin\slash offers\slash export}: Exporta la lista de ofertas disponibles en formato Excel. 

	\item \textbf{POST \slash nevado\slash admin\slash offers\slash idOferta}: Permite modificar las fechas en la que la oferta está disponible, así como la descripción de la misma. 

	\item \textbf{GET \slash nevado\slash admin\slash offers\slash idOferta}: Elimina una oferta del sistema.

	\item \textbf{GET \slash nevado\slash admin\slash offers\slash Products}: Devuelve los productos que tienen ofertas. 

	\item \textbf{GET \slash nevado\slash admin\slash messages}: Retorna la lista de mensajes enviados por los usuarios.

	\item \textbf{GET \slash nevado\slash admin\slash messages\slash export}: Exporta la lista de mensajes enviados por los usuarios en formato Excel. 

	\item \textbf{DELETE \slash nevado\slash admin\slash messages\slash idMensaje}: Elimina un mensaje.

	\item \textbf{POST \slash nevado\slash admin\slash messages\slash idMensaje}: Permite poner el mensaje como leído o no leído. 

	\item \textbf{POST \slash nevado\slash admin\slash messages\slash send}: Envía la respuesta a un mensaje a través de un correo electrónico. 

	\item \textbf{GET \slash nevado\slash admin\slash import\slash template}: Descarga la plantilla Excel que hay que usar para poder importar datos de manera masiva en la tienda \emph{online}. 

	\item \textbf{POST \slash nevado\slash admin\slash import\slash upload}: Importa los datos del archivo Excel seleccionado. 

	\item \textbf{GET \slash nevado\slash admin\slash import\slash getImportData}: Muestra el \emph{log} de la importación.

\end{itemize}

\textbf{API parte pública de la aplicación}

La parte pública de la aplicación la forman las vistas que no necesitan un rol específico para interactuar en ellas. Los \emph{endpoints} de esta parte son los siguientes: 

\begin{itemize}
	\item \textbf{GET \slash home}: Muestra la página principal de la aplicación. 

	\item \textbf{GET \slash home\slash topVentas}: Devuelve los productos más vendidos para mostrarlos en el apartado Top Ventas de la página principal. 

	\item \textbf{GET \slash home\slash ofertas}: Devuelve los productos que tienen ofertas para mostrarlos en el apartado ofertas de la vista principal. 

	\item \textbf{GET \slash home\slash largeAppliances}: Muestra las subcategorías que tiene la categoría Gran electrodoméstico.

	\item \textbf{GET \slash home\slash smallKitchenAppliances}: Muestra las subcategorías que tiene la categoría Pequeño electrodoméstico de cocina.

	\item \textbf{GET \slash home\slash image}: Muestra las subcategorías que tiene la categoría Imagen.

	\item \textbf{GET \slash home\slash sound}: Muestra las subcategorías que tiene la categoría Sonido.

	\item \textbf{GET \slash home\slash telephony}: Muestra las subcategorías que tiene la categoría Telefonía y electrónica.

	\item \textbf{GET \slash home\slash personalCare}: Muestra las subcategorías que tiene la categoría Cuidado personal.

	\item \textbf{GET \slash home\slash computing}: Muestra las subcategorías que tiene la categoría Informática.

	\item \textbf{GET \slash home\slash product\slash idProducto}: Devuelve la información relativa a un producto para mostrar esta información en la vista de detalle del producto.

	\item \textbf{GET \slash home\slash brand}: Devuelve el logo de la marca del producto pasado como parámetro para mostrarlo en la vista detalle del producto. 

	\item \textbf{GET \slash home\slash similarProducts}: Permite ver productos similares en la página de detalle de productos. Ofreciendo diferentes alternativas al producto seleccionado. 

	\item \textbf{GET \slash home\slash category\slash nombreCategoria}: Devuelve todos los productos de una subcategoría. Estos productos se mostrarán en la vista de la subcategoría seleccionada.

	\item \textbf{GET \slash home\slash brands}: Devuelve los productos de una subcategoría filtrados por marca. 

	\item \textbf{GET \slash home\slash paymentMethods}: Retorna los métodos de pago con los que el cliente puede pagar su pedido. 

	\item \textbf{GET \slash home\slash cart}: Permite ver los productos que hay en el carrito de compra. 

	\item \textbf{GET \slash home\slash termUse}: Muestra la página de condiciones de uso. 

	\item \textbf{GET \slash home\slash faq}: Muestra la página de preguntas frecuentes.

	\item \textbf{GET \slash home\slash contact}: Muestra la página de ¿quiénes somos?.

	\item \textbf{GET \slash home\slash privacyPolicy}: Muestra la página de política de privacidad.

	\item \textbf{POST \slash home\slash review}: Añade una reseña en un producto. 

	\item \textbf{POST \slash home\slash saveOrder}: Permite finalizar el pedido. 

	\item \textbf{POST \slash home\slash message}: Envía un mensaje al administrador de la aplicación. 


\end{itemize}


\subsection{Registro y autenticación de usuarios} 
\label{sec:autenticacion}

La aplicación consta de dos perfiles de usuario, un perfil cliente y un perfil administrador. El perfil cliente se asigna a un usuario cuando se registra en la aplicación. El perfil administrador únicamente lo tiene el dueño o administrador de la tienda \emph{online}. Además, el perfil administrador permite acceder a la trastienda.

\textbf{Proceso de registro de un usuario}

Cuando un usuario decide registrarse en la tienda \emph{online} debe acceder a $\slash nevado\slash login$, seleccionar la pestaña Registrarse y rellenar los campos obligatorios para el registro. Cuando el usuario pulsa sobre el botón registrarse se realiza una petición al servidor, en la que viajan los datos introducidos por el usuario. El servidor comprueba si el \emph{email} introducido ya se encuentra en el sistema. Para ello, realiza una búsqueda en la base de datos. Si el \emph{email} ya está registrado se devuelve un error, indicando que el usuario ya está registrado. Si, por el contrario, el \emph{email} no se encuentra en nuestro sistema entonces guarda los datos del usuario en la base de datos, creando un nuevo registro en la colección de usuarios. Antes de crear el registro, se deben proteger los datos más susceptibles del usuario. La contraseña es la que permite realizar compras y acceder a la información personal del usuario, por lo que no se puede guardar en la base de datos en texto plano. Según la Ley de protección de datos, en su artículo noveno, el encargado del tratamiento de los datos susceptibles debe garantizar la seguridad de los mismos adoptando las medidas técnicas y organizativas necesarias. Para cumplir con este artículo, se cifra la contraseña utilizando la biblioteca Bcryptjs. Esta biblioteca permite realizar una cifrado robusto frente ataques de fuerza bruta, como se ha mencionado en la sección~\ref{sec:bcryptjs}. Para llevar a cabo el cifrado de la contraseña se realizan los siguientes pasos: 

\begin{enumerate}
	\item Se genera el \emph{salt}, valor aleatorio que es usado para dar mayor robustez a el cifrado. Para generar este valor se utiliza la función \emph{genSalt}, función propia de la biblioteca de Bcrypt. El \emph{salt} generado tiene una longitud de 10 caracteres, valor por defecto de Bcrypt. Se ha optado por este valor porque es lo suficientemente grande para evitar que ataques de fuerza bruta consigan descifrar la contraseña. Además, con este valor el proceso de cifrado no se demora mucho tiempo. 
	\item Se cifra la contraseña utilizando la función \emph{hash}, también de Bcrypt. Para llevar a cabo el cifrado, esta función utiliza el \emph{salt} generado en el paso anterior. 
\end{enumerate}

Una vez cifrada la contraseña, se crea el nuevo registro en la colección usuarios. Además, se crea una nueva entrada en la colección clientes, que almacena la información personal del cliente. Para dar por finalizado el proceso de registro, se envía un correo al usuario. El correo contiene un enlace de confirmación de la cuenta. De este modo, se garantiza que el correo introducido por el usuario es válido y está dado de alta en un sistema de mensajería. Si el usuario no confirma el correo no podrá realizar compras en la tienda \emph{online}. 

\textbf{Proceso de autenticación de un usuario}

Un usuario debe autenticarse para poder realizar determinadas operaciones dentro de la tienda \emph{online}, por ejemplo, realizar sus compras, acceder a sus datos personales o acceder a la información de sus pedidos. Para realizar esta autenticación se ha utilizado la biblioteca $Passportjs$. Esta biblioteca permite realizar este proceso de manera sencilla y rápida. Passport almacena los datos necesarios para la autenticación en una cookie de sesión. Para configurar dicha cookie de sesión se ha usado $express-session$, que es un módulo de Express. La configuración se realiza cuando se arranca el servidor de Node.js, por lo que se encuentra situada en el fichero app.js. Los parámetros que se han configurado son el tiempo de expiración de la cookie, dónde se guardan las sesiones y el valor de la clave \emph{secret}. Este \emph{secret} es una cadena de texto que se utiliza como identificador y que permite validar la sesión. Passport tiene muchas estrategias para autenticar a un usuario, en la aplicación se ha optado por utilizar $Passport\-local$, la cual utiliza el \emph{email} y la contraseña para realizar la autenticación. 

Para acceder a una cuenta de usuario, se deber navegar a $\slash nevado\slash login$, acceder a la pestaña entrar, rellenar el \emph{email} y la contraseña y pulsar sobre el botón entrar. Al pulsar sobre el botón, se realiza una petición al servidor, en la que viajan la contraseña y el \emph{email} introducido por el usuario. El servidor ejecuta la estrategia de Passport que se ha implementado. Esta estrategia consiste en buscar el \emph{email} en el sistema. Si no lo encuentra envía un error, indicando que el usuario no está registrado. Si lo encuentra, procede a comparar la contraseña enviada con la almacenada. Para realizar esta comparación se ha utilizado la función de bcrypt \emph{compare}, que cifra la contraseña introducida y la compara con la almacenada. Si las contraseñas no coinciden se envía un error. Si coinciden, Passport crea una sesión de usuario que serializa y guarda en la base de datos. Además, estos datos de la sesión se añaden a la cookie, la cual se envía en cada una de las peticiones realizadas al servidor. De esta forma, no hay que enviar el \emph{email} y la contraseña en cada llamada. El servidor únicamente se encargará de validar la cookie enviada.

Para acceder a determinadas vistas de la aplicación como, por ejemplo, las vistas de administración, el usuario, además de estar logueado, deberá tener el perfil de administrador. Para hacer esta comprobación, en cada llamada realizada bajo el contexto $\slash admin$ se ejecutará una función que valida que el usuario tenga este perfil. Si el perfil no coincide, no se permitirá el acceso a esta parte y se redireccionará a la página principal. 

\subsection{Sistema de subida de archivos en el servidor} 
\label{sec:subidaArchivos}

La aplicación permite realizar subidas de archivos al servidor. Los archivos que se permiten subir son imágenes y archivos .zip. La subida de imágenes se produce al registrar un nuevo producto o al actualizarse. Además, se suben imágenes al añadir a la tienda \emph{online} nuevos proveedores, nuevas categorías y nuevas formas de pago. Las imágenes tienen que tener un formato determinado para poder subirse ($.jpeg$, $.jpg$ o $.png$). Si el formato es diferente se produce un error, que se muestra por pantalla. Los archivos .zip se suben al servidor cuando se realiza la importación de productos, categorías o marcas. El sistema de importación se explica en la sección~\ref{sec:importacion}.

Para realizar esta subida de archivos en el servidor, se ha utilizado la biblioteca $Multer$ de Node.js. $Multer$~\cite{multer} facilita el manejo de datos codificados como multipart/form-data. Para ello, se incluye la biblioteca y se configura pasándole como parámetro el \emph{path} donde se almacenarán los archivos subidos. En el \emph{route} (endpoint correspondiente) se ejecuta la función \emph{single}, pasándole como parámetro el nombre del campo del formulario donde se envió el fichero.

\begin{center}
	
	{\small \emph{var multer = require('multer');}}

	{\small\emph{var upload = multer({ dest: properties.get('nevado.server.import.folder') });}}

	{\small\emph{routesImport.post('/upload', passportConfig.isAuthenticated, upload.single('file'), ... {});}}
\end{center}

\subsection{Generación de PDFs} 
\label{sec:pdfs}

Cuando se realiza un pedido es necesario enviar la factura, ya que es esta la que actúa como ticket de compra. Por ello, se ha implementado una funcionalidad que permite generar el PDF de una factura. Para la generación de los PDFs se ha utilizado la biblioteca $HTML-PDF$~\cite{HTML-PDF} de Node.js. A través de un HTML, generado con la información recogida en la base de datos, se crea el PDF. Para ello, se utiliza la función \emph{create} de la biblioteca, a la cual se le pasa el HTML generado y se llama a la función \emph{toFile}, a la que se le indica donde se crea el archivo PDF y qué nombre va a tener dicho archivo. 
%\begin{center}
	
%	{\small \emph{const pdf = require('html-pdf');}}

%	{\small\emph{pdf.create(content).toFile(properties.get('nevado.server.invoices')+"/" +  fileName+".pdf", ...);}}

%\end{center}

\begin{figure}[H]
  \centering
  \includegraphics[width=14cm, keepaspectratio]{img/factura2.png}
  \caption{Ejemplo PDF factura.}
  \label{fig:factura}
\end{figure}

\subsection{Sistema de importación y exportación} 
\label{sec:importacion}

Una tienda \emph{online} requiere tener en su catálogo numerosos productos. Añadir cada uno de ellos al sistema puede llegar a ser pesado y tedioso. Por eso, se ha implementado un sistema de importación, que permite cargar masivamente datos en la base de datos. En este sistema se pueden cargar productos, marcas y categorías. 

Para realizar la importación el administrador de la tienda debe ir a $\slash admin\slash import$, seleccionar el tipo de datos que se van a importar, es decir, debe indicar si son productos, categorías o marcas y pulsar el botón importar. Cuando se pulsa el botón importar se realiza una petición al servidor, en la que viaja el archivo a importar. El tipo de archivo que se permite importar es .zip. El zip contiene un Excel con los registros que se quieren añadir a la base de datos y las imágenes asociadas a cada registro. Cuando se recibe la petición, se guarda el archivo .zip en el servidor, como se explica en la sección~\ref{sec:subidaArchivos} y, posteriormente, se realiza la importación. Para ello, se descomprime el archivo .zip, utilizando la biblioteca $Adm-zip$~\cite{adm-zip}. Se extrae el documento Excel y se parsea dicho documento para convertirlo en un array de objetos JSON. Para realizar el parseo del documento Excel se usa la biblioteca $SheetJS-XLSX$~\cite{sheetJs-XLSX}. El array va a tener tantos objetos JSON como registros tenga el documento Excel. A cada objeto JSON se le añade la ubicación de la imagen asociada a cada registro. Antes de guardarlo en la base de datos, se realizan una serie de comprobaciones como, por ejemplo, que todos los campos obligatorios estén rellenos o, en el caso de los productos, que el precio sea numérico o la marca y categoría exista en  la base de datos. Una vez terminada esta comprobación, se insertan en la base de datos todos los registros, utilizando la instrucción \emph{insertMany} de Mongoose, realizando así una única \emph{query}. Cuando el proceso termina, se muestra en pantalla, a través de un sistema de \emph{log}, el número de registros importados y cuales de ellos han fallado, indicando el número de línea y el error producido. 

Para facilitar la creación de los documentos Excel y evitar errores a la hora de importarlos, se ha implementado una opción de descarga de plantilla. Para descargar esta plantilla, basta con seleccionar el tipo de dato que se quiere importar y pulsar sobre el botón plantilla, descargando un documento Excel con las cabeceras de los campos que se han de rellenar. Este sistema de descarga de plantilla es similar al sistema de descarga de los documentos Excel que se encuentran en las distintas vistas de la parte de administración.

Para la creación de los documentos Excel, se utiliza la biblioteca de Node.js $excel4node$~\cite{excel4Node}. El documento Excel se va rellenando con los metadatos de la cabecera y los datos devueltos por la base de datos. En el caso de la plantilla, sólo se rellena la cabecera del documento Excel. Este documento se envía en la respuesta al cliente, y éste lo descarga utilizando \emph{saveAs} de la biblioteca de Angular $File-saver$~\cite{file-saver}. 

\subsection{Envío de correos} 
\label{sec:nodemailer}

Para el envío de correos se ha utilizado la biblioteca $Nodemailer$~\cite{nodemailer} de Node.js. Lo primero que se hace es crear un objeto con la función \emph{createTransport}. A esta función se le pasan las credenciales de la cuenta desde la que se va a realizar el envío. Posteriormente, se crea un nuevo objeto con los datos del usuario que recibe el correo, el asunto y el mensaje del correo. Y, por último, se envía el correo utilizando la función \emph{sendMail} de la propia biblioteca. El envío de correos se ha usado en el registro del usuario, en el restablecimiento de la contraseña y en la respuesta de las preguntas de los usuarios al administrador. 

\section{Diseño e implementación del cliente} 
\label{sec:implementacionCliente}

El cliente se ha desarrollado utilizando Angular y está programado en TypeScript. Está formado por diferentes vistas, que forman la interfaz de usuario. Estas vistas se cargan de manera dinámica e instantánea, ya que cuando se modifica la URL no se recarga la página. Por lo tanto, el cliente se ha implementado como Single-Page. Además, con el uso de Angular, el cliente tiene una arquitectura modelo-vista-controlador. 

El cliente es el encargado de recoger la información introducida por el usuario cuando interactúa en la aplicación. Para atender los eventos lanzados por el usuario, se ha alojado en el servidor proporcionado por Angular CLI.

\subsection{Estructura del cliente} 
\label{sec:estructuracliente}

\begin{itemize}
	\item \textbf{\slash node\_modules}: Directorio donde se encuentran instaladas las dependencias del cliente. Estas bibliotecas se descargan y se instalan mediante la instrucción \emph{npm install}, ya que Angular CLI usa Node.js para ejecutar su servidor. 

	\item \textbf{package.json}: Archivo donde se especifican las dependencias utilizadas en el proyecto. Estas dependencias se declaran junto con la versión utilizada. 

	\item \textbf{proxy.conf.json}: Archivo de configuración del  \emph{proxy} utilizado como intermediario entre el cliente y el servidor. 

	\item \textbf{tsconfig.json}: Archivo de configuración del compilador de los archivos TypeScript.

\end{itemize}

\begin{figure}[H]
  \centering
  \includegraphics[width=14cm, keepaspectratio]{img/estructuraCliente.png}
  \caption{Estructura de los directorios del cliente.}
  \label{fig:estructuraArchivoscliente}
\end{figure}

En la figura~\ref{fig:estructuraArchivoscliente} se puede observar como está organizado el cliente. 

\begin{itemize}

	 

	\item \textbf{\slash src}: Directorio donde se encuentra la lógica del cliente, en él se sitúan los componentes, las directivas y los servicios utilizados para interactuar en la interfaz de usuario. Está formado por: 

	\begin{itemize}
		\item \textbf{index.html}: Archivo HTML principal de la interfaz de usuario. Es el punto de entrada a la aplicación. En él se carga el componente principal, los estilos generales y los \emph{script}s necesarios para el correcto funcionamiento del cliente. 

		\item \textbf{main.ts}: Archivo TypeScript principal. En él se establece el módulo principal del cliente, siendo este \textbf{AppModule}.

		\item \textbf{styles.css}: Archivo donde se definen los estilos generales de la interfaz de usuario. 

		\item \textbf{\slash fonts}: Directorio donde se almacenan las fuentes utilizadas en la interfaz de usuario. 

		\item \textbf{\slash enviroments}: Directorio donde se establece la configuración de los distintos entornos (desarrollo, test, producción). En el caso de la aplicación, no se ha configurado ningún entorno, ya que siempre se ha trabajado en local.

		\item \textbf{\slash assets}: Directorio donde se almacenan los recursos estáticos como el logo o las imágenes del \emph{carousel} implementado en la página \textit{home} de la aplicación. 

		\item \textbf{\slash app}: Directorio que contiene los componentes, servicios y directivas utilizados para implementar el cliente. Está compuesto por: 

		\begin{itemize}
			\item \textbf{app.module.ts}: Módulo principal del cliente. En este archivo se especifican todos los componentes que forman la interfaz de usuario. 

			\item \textbf{app.component.html}: Archivo HTML del componente principal. Está formado por dos componentes fijos para todas las vistas, \textit{Header} y \textit{Footer}, y una parte variable donde se cargan los distintos componentes. Estos componentes varían según se modifique la URL. 

			\item \textbf{app.routing-module.ts}: Archivo donde se asocian los componentes, que se cargan en la parte variable del componente principal, con cada una de las rutas de la aplicación. 

			\item \textbf{mat.module.ts}: Archivo donde se declaran los módulos de Angular Material que se pueden utilizar.

			\item \textbf{\slash components}: Directorio que contiene los componentes que forman el cliente. Se divide en cinco subdirectorios. \textbf{\slash admin} (componentes de la trastienda), \textbf{\slash client} (componentes de la parte pública de la tienda), \textbf{\slash footer} (componentes del pie de página), \textbf{\slash header} (components de la cabecera), \textbf{\slash init-page} (componentes que forman la vista \textit{home} de la tienda). Cada uno de los componentes tiene asociado un archivo HTML, un archivo CSS y un archivo .ts, que es el controlador del componente. 

			\item \textbf{\slash dataModels}: Directorio que contiene los modelos de datos utilizados en el cliente. En este directorio se encuentra el archivo \textbf{properties.ts}, que contiene los contextos de las peticiones realizadas al servidor. De este modo, si uno de los contextos se modifica únicamente habría que modificar este fichero y no todos los archivos donde se encuentra el contexto a modificar. 

			\item \textbf{\slash services}: Directorio que contiene los servicios utilizados en los controladores de los componentes. Estos servicios se pueden usar desde cualquier componente. Sirven para compartir datos y funcionalidades entre componentes, y para definir las peticiones a la API. Se divide en tres subdirectorios: \textbf{\slash admin} (servicios usados en la trastienda), \textbf{\slash front} (servicios usados en la parte pública de la tienda), \textbf{\slash faq} (servicio usado en el componente preguntas frecuentes). 

			Además, contiene los archivos \textbf{auth-service.service} (contiene las peticiones a la API del registro), \textbf{user-service.service} (servicio donde se definen las variables de usuario que se guardan en el localStorage). 

		\end{itemize}

	\end{itemize}

\end{itemize}

\subsection{Vistas} 
\label{sec:vistas}

Las vistas de la aplicación forman la interfaz de usuario. Cada vista está formada por uno o más componentes. Cada uno de estos componentes tiene asociado un controlador, una hoja CSS y un documento HTML. Trabajar con Angular hace que el código esté ordenado, por lo que las aplicaciones son más escalables.
Para aumentar la escalabilidad de la aplicación se han creado componentes reutilizables, es decir, componentes que se usan en varias vistas de la aplicación. Crear estos componentes reutilizables significa aumentar la mantenibilidad de las aplicaciones, ya que a la hora de producirse un error o una actualización en uno de los componentes reutilizables supone modificar únicamente el componente reutilizable, evitando modificar cada uno los componentes afectados por el error o la actualización.

Los componentes que se reutilizan en la aplicación son: 

\begin{itemize}
	\item \textbf{Client-product}: Tarjeta resumen del producto. Muestra la información más importante del producto, marca, modelo, precio y envío gratuito, si lo tuviese. Permite añadir el producto al carrito de compra pulsando el botón ``comprar'', sin necesidad de pasar por la vista de \textit{Detalle del producto}. Se utiliza $n$ veces en el \textit{Home} de la aplicación, ya que se usa para mostrar los productos más vendidos y los productos que tienen oferta. También, se utiliza tantas veces como productos tenga la subcategoría en la vista \textit{Listado de productos}. Además, se utiliza en la vista \textit{Detalle del producto} para mostrar los productos de la sección \textit{Artículos relacionados}. 

	\begin{figure}[H]
	  \centering
	  \includegraphics[width=4cm, keepaspectratio]{img/tarjeta_resumen.png}
	  \caption{Ejemplo de una tarjeta resumen del producto (Componente client-product).}
	  \label{fig:tarjetaResumen1}
	\end{figure}

	\item \textbf{Product-row}: Fila de tarjetas resumen del producto. Permite mostrar varias tarjetas resumen en una misma fila. Se utiliza en el \textit{Home} de la aplicación, tanto en top ventas como en ofertas, y en la vista \textit{Detalle del producto} en el apartado \textit{Artículos relacionados}.

	\begin{figure}[H]
	  \centering
	  \includegraphics[width=15cm, keepaspectratio]{img/product_row.png}
	  \caption{Ejemplo fila de tarjetas resumen del producto (Componente product-row).}
	  \label{fig:tarjetaResumen2}
	\end{figure}

	\item \textbf{Product-detail-client}: Detalle del producto. Permite visualizar la información del producto de manera detallada. Se utiliza cada vez que se pulsa sobre la imagen o el modelo del producto en el componente \textit{client-product}.

	\begin{figure}[H]
	  \centering
	  \includegraphics[width=12cm, keepaspectratio]{img/detalle_producto.png}
	  \caption{Ejemplo detalle del producto (Componente Product-detail-client).}
	  \label{fig:tarjetaResumen3}
	\end{figure}

	\item \textbf{Client-categories}: Tarjeta subcategoría. Permite visualizar el nombre y la imagen con la que se caracteriza una subcategoría. Se utiliza tantas veces como subcategorías tenga la categoría general. 

	\begin{figure}[H]
	  \centering
	  \includegraphics[width=6cm, keepaspectratio]{img/tarjeta_subcategoria.png}
	  \caption{Ejemplo tarjeta subcategoría (Componente Product-detail-client).}
	  \label{fig:tarjetaResumen}
	\end{figure}
\end{itemize}

\textbf{Vistas parte pública de la tienda}

Todas las vistas de la parte pública de la tienda tienen dos componentes comunes: \textit{Header} (cabecera de la página) y \textit{Footer} (pie de página).

\begin{itemize}
	\item \textbf{Header}: Es una barra de navegación que se adapta en función de si se ha iniciado sesión. Si el usuario no ha iniciado sesión, se muestra un enlace para ver el carrito y otro para hacer \emph{login}. Si el usuario ha iniciado sesión, se muestran enlaces para cerrar sesión, acceder a la información personal, ver los pedidos realizados y visualizar el carrito. 

	\item \textbf{Footer}: Pie de página que contiene los enlaces para ver las condiciones de uso, la política de privacidad, las preguntas frecuentes y la página de contacto. A diferencia del \textit{Header}  los enlaces siempre son los mismos.
\end{itemize}

Vistas que no necesitan autenticarse en la aplicación para poder visualizarse:

\begin{itemize} 

	\item \textbf{Login}: Página donde el usuario puede registrarse o acceder a su cuenta. Está formado por dos pestañas, uno para el registro y otro para el \emph{login}. Cada pestaña es un formulario donde el usuario debe rellenar los datos de acceso (en el caso del \emph{login}) y los datos para darse de alta (en el caso del registro). En ambos formularios se comprueba que los campos estén rellenos y que los datos sean válidos. Cuando se crea una cuenta, la contraseña y la contraseña de confirmación deben coincidir. Además, se informa al usuario de la fortaleza de la contraseña. Si se produce un error en el registro o en el acceso a la cuenta, se muestra un mensaje en pantalla a través del sistema de avisos, explicado en la sección~\ref{sec:sistemaAvisos}. 

	\item \textbf{Recuperar contraseña}: Vista que permite restablecer la contraseña, enviando un enlace al correo introducido en el formulario. Previamente, se comprueba que el correo es válido para un usuario de la aplicación. El enlace redirecciona a una nueva vista con dos campos a rellenar, la nueva contraseña y su confirmación. Cuando se pulsa el botón ``Cambiar contraseña'' se actualiza la contraseña.

	\item \textbf{Home}: Vista principal de la parte pública de la aplicación. Está formada por un menú que permite la elección de categorías generales, un \emph{carousel}, que sirve de sistema de anuncios, y dos listados de productos, el \textit{Top ventas} y \textit{Ofertas}. Ambos listados están desarrollados con los componentes reutilizables \textit{Product-row} y \textit{client-product}. Al pulsar sobre la foto o modelo del producto se navega a la vista \textit{Detalle del producto}. Si se pulsa el botón comprar se añade un producto a la cesta. Las categorías generales son enlaces que permiten navegar a la vista de la categoría general seleccionada. Este elemento de la vista se convierte en un \emph{dropdown} cuando el tamaño de la vista es pequeño. 

	\item \textbf{Categoría}: Vista en la que se muestran las subcategorías de una categoría general. Las subcategorías se visualizan a través del componente reutilizable \textit{client-categories}. Si se pulsa sobre la foto se navega al listado de productos de la subcategoría. 

	\item \textbf{Listado de productos de una subcategoría}: Vista en la que se muestra el listado de los productos de una subcategoría. Este listado está paginado permitiendo al usuario elegir la cantidad de productos a mostrar, siendo 12 el número máximo. Se diseñó así para evitar cargar todos los productos de la base de datos, haciendo que la \emph{query} sea rápida y eficiente. Para la creación del listado se ha utilizado el componente \emph{grid} de Angular Material, que a su vez muestra los productos utilizando el componente \textit{client-product}. Los productos se pueden ordenar por: los más vendidos, los mejores valorados o de más caros a más baratos y viceversa. Además, se puede filtrar por marca (únicamente se muestran las marcas de los productos de la subcategoría seleccionada), por precio (en un rango de 0 a 1000), por disponibilidad, por oferta y por características. Para implementar el menú de filtros se ha utilizado \emph{mat-accordion} de Angular Material. Para realizar el filtrado y la ordenación de los productos se ha recurrido al uso de la función \emph{aggregate} de Mongoose, que permite transformar los datos por etapas hasta conseguir el resultado esperado. 

	\item \textbf{Detalle del producto}: Vista que permite conocer la información detallada de un producto: Foto, marca, modelo, estrellas, envío (si es gratuito o no), promociones, disponibilidad, características y reseñas.

	La información de la disponibilidad cambia de color en función de la cantidad de productos en stock. Si no hay stock se muestra en rojo, si el stock es inferior a 5 se muestra en amarillo y si es mayor se muestra en verde.

	Las características se visualizan con el formato que se definió (con \textit{html-editor}) cuando el producto se almacenó en el sistema. 

	Las reseñas pueden ser filtradas por el número de estrellas de cada valoración. Para escribir una nueva valoración de un producto, se utiliza la vista \textit{Añadir reseña} y es necesario haber iniciado sesión. 

	Cuando se pulsa el botón comprar se añade el producto al carrito, guardando los datos necesarios en el \emph{LocalStorage} en formato JSON.

	\item \textbf{Carrito}: Muestra los productos que hay en el carrito, el total del carrito y la forma de entrega. Cuando la cantidad elegida de un producto es mayor que uno, la forma de entrega es la misma para todos. Si el carrito contiene diferentes productos, se permiten diferentes formas de entrega (envío a domicilio o recogida en tienda). Además, se permite la eliminación de los productos de forma individual o colectiva, al pulsar ``Vaciar cesta''. Para la implementación del carrito se ha utilizado \emph{LocalStorage}, donde se almacenan los productos seleccionados por el usuario en formato JSON.

	% \item \textbf{Contacto}: Vista que permite conocer los datos de contacto de la tienda física. Además, permite conocer como se fundó la tienda de electrodomésticos Nevado.

	% \item \textbf{Condiciones de uso}: Vista que contiene las condiciones de uso de la tienda \emph{online}. Se explica como deben efecturarse los pedidos, como se realizan los envíos, como hay que hacer las devoluciones y como es la garantía de los productos. 

	% \item \textbf{Política de privacidad}: Vista en la que se define la política de privacidad. Por la Ley de protección de datos la tienda debe informar a los usuarios como van a ser tratados sus datos. Y son estos, los que deciden si lo aceptan o no. 

	\item \textbf{Preguntas frecuentes}: Vista que permite conocer la respuesta de las preguntas más frecuentes formuladas por los usuarios. Cuando el usuario ha iniciado sesión puede enviar preguntas al administrador a través del formulario que aparece en esta vista. El administrador puede ver los mensajes desde la trastienda y contestarlos enviando un correo.
\end{itemize}

Vistas donde el usuario necesita estar logueado para visualizarlas: 

\begin{itemize}
	\item \textbf{Añadir reseña}: Vista que permite publicar la valoración de un producto. Es un formulario con los campos: valoración general, título, comentario, recomendación a otros usuarios y valoración del producto en cuanto a calidad precio. La valoración general, en forma de número de estrellas, se suma al computo total de estrellas de producto que, finalmente, se muestra en la vista \textit{Detalle del producto} junto con la reseña.

	\item \textbf{Perfil de usuario}: Vista donde se visualiza la información personal del usuario, es decir, nombre, apellidos, \emph{email}, teléfono, fecha de nacimiento, DNI, dirección de facturación, código postal, municipio,  provincia de la dirección de facturación y la dirección, el código postal, el municipio y la provincia de envío. Todos los campos son obligatorios para realizar compras, excepto los de la dirección de envío que serán obligatorios si la dirección de facturación es distinta. Si algún campo no se rellena se mostrará un mensaje de error en la pantalla a través del sistema de aviso, explicado en la sección~\ref{sec:sistemaAvisos}. Esta vista se muestra cuando el usuario accede a ella a través del enlace de la barra de navegación y cuando se tramita el pedido, ya que el usuario debe comprobar los datos antes de finalizar con el pedido. 

	\item \textbf{Pedidos del usuario}: Vista que permite conocer al usuario los pedidos realizados y el estado de cada uno de ellos. Es una tabla en la que se visualiza el identificador del pedido, la fecha del pedido, la fecha aproximada de entrega y el estado. La tabla está paginada y el usuario puede decidir la cantidad de pedidos que desea mostrar por página. Además, se le permite filtrar por identificador de pedido, estado o fecha de pedido. 

	\item \textbf{Métodos de Pago}: Vista donde el usuario decide el método de pago del pedido. Se puede elegir entre tarjeta de crédito, Paypal y contra-reembolso. Cuando se selecciona tarjeta de crédito aparece un formulario con el tipo de tarjeta, el nombre del titular, la fecha de expiración, el número de tarjeta de pago y el CCV. Además, se comprueba que el número de tarjeta sea válido para el tipo de tarjeta seleccionado, que el CCV sea de tres posiciones y que la fecha de expiración tenga un formato correcto. Cuando se selecciona el método de pago Paypal aparece el botón ``Paypal pagar'', que permite realizar el pago en el sitio web de Paypal. Cuando se selecciona contra-reembolso únicamente aparece el botón ``Finalizar pedido''. Al finalizar el pedido se genera la factura, excepto en la opción contra-reembolso que se genera manualmente por el administrador una vez que se cobre el pedido. El pago con tarjeta de crédito finaliza tras la validación de la tarjeta. No se ha implementado la conexión con el banco porque requería datos y cuentas reales. 
 
\end{itemize}

\textbf{Vistas de la trastienda}

La vista principal de la trastienda está compuesta por: 

\begin{itemize}
	\item \textbf{Header}: Es el componente \textit{header} descrito anteriormente. Cuando el perfil del usuario es administrador, se muestra un indicador con el número de pedidos en estado pendiente.
	\item \textbf{Menú}: El menú se muestra en el lateral izquierdo y permite seleccionar las diferentes secciones de administración. Cuando se reduce el tamaño de pantalla, el menú cambia de posición y se muestra debajo del \textit{header}. 
	\item \textbf{Espacio de trabajo}: Es un contenedor que rellena todo el espacio disponible y donde se muestran las distintas secciones de administración. 
\end{itemize}

Las secciones de la trastienda son: Clientes, pedidos (pedidos y facturas), catálogo (productos, marcas y categorías), servicios (métodos de pago y transporte), ofertas, importación y mensajería.

Todas las secciones se organizan de la misma forma. Tienen una tabla, creada con \emph{mat-table} de Angular Material, que muestra la información de cada sección de forma paginada. Cada tabla puede ordenar y filtrar la información. Para ello, se recogen los valores de filtrado mediante un formulario y se envían al servidor, que se encarga de introducirlos en la \emph{query} para devolver exclusivamente los datos que coinciden. Además, las tablas son exportables a Excel (sección~\ref{sec:importacion}). También, hay tablas que permiten realizar acciones exclusivas. Por ejemplo, la tabla de facturas permite la exportación de cada factura en formato PDF (sección~\ref{sec:pdfs}). La tabla de mensajería, además de permitir ver los mensajes enviados por los usuarios, permite contestar enviando una respuesta por correo, utilizando la biblioteca $Nodemailer$ (sección~\ref{sec:nodemailer}). 

Cada uno de los registros de las tablas tiene opciones para mostrar datos, editar la información o borrar registros. Tanto en la visualización como en la edición o creación de registros, se crea una ventana de diálogo con \emph{mat-dialog} de Angular Material. Estas ventanas muestran y permiten la edición de los datos mediante formularios, creados con Angular Material. Todos los campos tienen control de errores. Además, son validados en el servidor y en caso de error se muestra un mensaje con el sistema de avisos (sección~\ref{sec:sistemaAvisos}).  En algunas de estas ventanas, por ejemplo, productos o marcas, se permite la subida de imágenes (sección~\ref{sec:subidaArchivos}) para después mostrarlas en la parte pública de la tienda. En la ventana de productos se ha utilizado la biblioteca \emph{HTML-editor}, que permite escribir texto formateado (listas, colores, tamaños y tipos de letras, entre otras). Este texto formateado corresponde con las características de cada producto, que se mostrará en la parte pública de la tienda. 

La sección de importación es completamente diferente a las descritas anteriormente. Esta sección permite la descarga de plantillas XLSX para ser importadas después, lo que permite cargar datos en la aplicación de manera masiva (sección~\ref{sec:importacion}). El resultado final de la importación se muestra en la misma pantalla, permitiendo conocer registros erróneos o duplicados. 

\subsection{Uso de Angular Material} 
\label{sec:usoAngularMaterial}

Como ya se vio en la sección~\ref{sec:Angular Material}, Angular Material es una biblioteca de Angular que permite crear componentes de manera rápida y sencilla. Sus componentes se adaptan a los distintos tamaños de pantalla, por lo que se suelen utilizar para crear diseños \emph{responsive}. En la aplicación se ha utilizado en: 

\begin{itemize}
	\item Las tablas de productos, clientes, pedidos, facturas, marcas, categorías, métodos de pago, empresas de transporte y mensajes. Para ello, se ha utilizado \emph{mat-table}. 

	\item Los diálogos de confirmación de borrado de productos, clientes, marcas, categorías, métodos de pago, empresas de transporte y mensajes. Usando para ello \emph{mat-dialog}.

	\item Los campos de los formularios utilizados para crear productos, marcas, categorías, métodos de pago y empresas de transporte. Y en los campos de los formularios donde se muestra la información de los pedidos, clientes, facturas y mensajes. Para crear estos campos se ha utilizado \emph{mat-form-field}.

	\item Los \emph{checkbox} de las vistas de información de producto, del carrito, de las reseñas, entre otros. Para ello, se ha utilizado \emph{mat--checkbox}

	\item El listado de productos y las subcategorías. Usando \emph{mat-grid-list}. 

	\item Los filtros del listado de productos. Usando \emph{mat-accordion}. 

	\item Las tabs de las vistas del \textit{Login} y del \textit{Detalle del producto}. Utilizando \emph{mat-tab}.

\end{itemize}


\subsection{Descarga de archivos} 
\label{sec:descargaArchivos}

Para la descarga de los archivos Excel generados en todas las tablas de la trastienda (productos, clientes, etc.) se ha utilizado la biblioteca $file-saver$. Para realizar la descarga hay que llamar a la función \emph{saveAs} pasándole como parámetros los bytes del archivo a descargar y el nombre con el que se va a guardar el archivo descargado. 

\subsection{Integración con Paypal} 
\label{sec:integracionPaypal}

Para realizar el pago a través de Paypal~\cite{paypal} se ha integrado la aplicación con el API de Paypal. De esta forma, se usa su pasarela de pagos y se evitan errores de seguridad al no tener que trabajar con los datos bancarios ni guardarlos en la base de datos.

Se han seguido los siguientes pasos: 
\begin{enumerate}
	\item Se crea una cuenta de Paypal para la tienda \emph{online} en el sitio web de desarrolladores.

	\item En la cuenta creada anteriormente, se crea un \emph{sandbox} que permite realizar y recibir pagos. Al crear el \emph{sandbox} se obtiene un ID, que se utilizará para identificar la cuenta en cada pago.

	\item Se modifica el HTML del componente \textbf{Métodos de pago} añadiendo un tag \emph{script} con la URL del \emph{script} de Paypal. Además, se añade el botón ``Paypal Pagar''. Cuando se carga el componente se descarga el \emph{script} con el código necesario, para que el botón ``Paypal Pagar'' funcione.

	\item Se añade un objeto ``paypalConfig'' en el componente \textbf{Métodos de pago}. Este objeto contiene la configuración para realizar los pagos. En él se incluye el entorno (producción o \emph{sandbox}), el ID del \emph{sandbox}, la moneda, la cantidad a pagar y una función (\emph{onAuthorize}) que se ejecuta cuando el pago ha sido validado. 

	%\small\begin{verbatim} 
	%	paypalConfig:  any = {
    %		env: 'sandbox',
   	% 		client: {sandbox: 'AcetckagNAGCl4yDvW...'},
    %		commit: true, 
    %		payment: (data, actions) => {
    %  			return actions.payment.create({
    %    			payment:{
    %    				transactions:[{amount:{total:this.total,currency:'EUR'}}]
    %    			}
    % 			 });
   	% 		},
    %		onAuthorize: (data, actions) => {
    %  			return actions.payment.execute().then((payment) =>{...});
   	% 		}
  	%	};
	%\end{verbatim}
	
	% \item Se añade el \emph{script} que permite llamar a la API de Paypal. Este \emph{script} se ejecuta al pulsar sobre el botón Paypal, que aparece al seleccionar Paypal como método de pago del pedido. 
	%\small\begin{verbatim} 
	%	addPaypalScript(){
    %	this.addScript =  true;
    %	return new Promise((resolve, reject) => {
    %  	let scripttagElement=document.createElement('script');
    %  	scripttagElement.src='https://www.paypalobjects.com/api/checkout.js';
    %  	scripttagElement.onload=resolve;
    %  	document.body.appendChild(scripttagElement);
    %	});
  	%	};
	%\end{verbatim}

	% \item Se añade el botón de Paypal en el HTML del componente ``métodos de pago''. 

	%\small\begin{verbatim} 
	%	addpaypal(){
   	% 		if(!this.addScript){
    %  			this.addPaypalScript().then(() => {
    %    			paypal.Button.render(this.paypalConfig, "#paypal-checkout-button")
    %    
    %  			})
   	% 		}
  	%	}

  	%\end{verbatim}

\end{enumerate}

Esta integración permite al usuario efectuar el pago en el sitio web de Paypal. Al pulsar sobre el botón ``Paypal pagar'' se abre la página de inicio de sesión. Después de hacer \emph{login}, el usuario puede elegir la forma de pago que más le conviene, ya que Paypal permite realizar pagos a través de su propia cuenta Paypal, a través de tarjeta bancaria o a través de transferencia. Cuando el usuario finaliza el pago, se cierra el sitio web de Paypal y se redirecciona a la página principal de la tienda \emph{online}, mostrando al usuario un mensaje indicando que su pedido ha finalizado correctamente. La figura~\ref{fig:procesoPagoPaypal} muestra este proceso.



\begin{figure}[H]
 \centering
 \subfloat{
    \includegraphics[width=0.25\textwidth]{img/metodoPagoPaypal.png}}
  \subfloat{
    \includegraphics[width=0.25\textwidth]{img/inicioSesionPaypal.png}}
  \subfloat{
    \includegraphics[width=0.25\textwidth]{img/realizar_pago.png}}
   \subfloat{
    \includegraphics[width=0.25\textwidth]{img/homePaypl.png}}
 \caption{Proceso de pago con Paypal.}
 \label{fig:procesoPagoPaypal}
\end{figure}

En la figura~\ref{fig:cuentasPaypal} se puede observar como el pago se descuenta de la cuenta del cliente y como se recibe en la cuenta de la tienda. 

\begin{figure}[H]
 \centering
 \subfloat[Pago]{
    \includegraphics[width=0.45\textwidth]{img/resumenPagosCliente.png}}
  \subfloat[Recibí]{
    \includegraphics[width=0.45\textwidth]{img/recibi.png}}
 \caption{Ejemplo cargo en la cuenta del cliente y recibí en la cuenta de la tienda.}
 \label{fig:cuentasPaypal}
\end{figure}


\subsection{Sistema de avisos} 
\label{sec:sistemaAvisos}

Se ha creado un sistema de avisos que permite informar al usuario del resultado de las operaciones realizadas en la tienda \emph{online}. Este sistema muestra un \emph{popup} en el margen superior derecho de las vistas. Si la operación ha finalizado de manera errónea, el \emph{popup} será de color rojo y, si por el contrario, ha finalizado correctamente el \emph{popup} será de color verde. La figura ~\ref{fig:mensajesAviso} muestra un ejemplo del formato de los avisos. 

\begin{figure} [H]
 \centering
 \subfloat{
    \includegraphics[width=0.5\textwidth]{img/avisoErroneo.png}}
  \subfloat{
    \includegraphics[width=0.5\textwidth]{img/mensajeCorrecto.png}}
 \caption{Ejemplos mensajes de aviso.}
 \label{fig:mensajesAviso}
\end{figure}


Para implementar este sistema de avisos se ha utilizado el servicio $ToastrService$ de la biblioteca de Angular $ngx-toastr$. Para ello, se llama a las funciones \emph{error}, cuando se produce un error, y \emph{success}, cuando el proceso es correcto. Ambas funciones reciben como parámetros el mensaje que se muestra en pantalla y el tiempo que el \emph{popup} es visible. 

\subsection{Diseño \emph{responsive}} 
\label{sec:disenoResponsive}

El acceso a las aplicaciones web se realiza desde diferentes dispositivos: ordenadores, tablets, móviles. Cada uno de estos dispositivos tiene una resolución y un tamaño de pantalla distinto, por lo que la visualización de las páginas no es la misma. Por esta razón, las aplicaciones web tienen que adaptar sus diseños a los diferentes tamaños de pantalla. 

Para que los usuarios de la tienda \emph{online} puedan acceder a través de diferentes dispositivos, se ha creado un diseño adaptativo, denominado diseño \emph{responsive}. Este tipo de diseño permite visualizar las vistas de la tienda \emph{online} en cualquier pantalla. En las figuras~\ref{fig:disenoResponsiveMovil} y~\ref{fig:disenoResponsiveOrdenador} se puede observar cómo el diseño se adapta al tamaño y resolución de la pantalla.

Para adaptar las vistas se ha recurrido al uso de componentes Bootstrap como, por ejemplo, la \emph{navbar} de la cabecera de las vistas, y al uso de las nuevas clases \emph{d-flex}, \emph{flex-column}, \emph{flex-row}, entre otras. Estas clases permiten posicionar los elementos en filas o columnas sin tener en cuenta si el elemento es un elemento de bloque. La variación de rejilla que tiene Bootstrap ($sm$, $md$, $lg$ y $xl$) ha permitido tener diferentes posicionamientos para los distintos tamaños de pantalla. 

%\begin{figure}[H]
% \centering
% \subfloat{
% 	\label{Movil}
%    \includegraphics[width=0.35\textwidth]{img/movil.png}}
    
%  \subfloat{
%  	\label{Ordenador}
%    \includegraphics[width=0.55\textwidth]{img/pantalla_grande.png}}
    
% \caption{Diseño \emph{responsive}.}
% \label{fig:disenoResponsive}
%\end{figure}


Para los elementos creados sin Bootstrap se ha utilizado Media Queries de CSS3, que permiten redefinir los estilos cuando el tamaño de pantalla lo requiere. Por tanto, un mismo elemento puede tener un estilo diferente para cada tamaño de pantalla.

En algunos componentes se ha recurrido a Angular utilizando la nomenclatura \emph{class.clase}, que permite añadir clases CSS al componente en función de unas condiciones determinadas por el tamaño de pantalla. Además, se utilizan diferentes plantillas que permiten modificar la vista en función del tamaño de pantalla. El tamaño de pantalla se calcula en el evento \emph{resize} del objeto \emph{window} de JavaScript.

\begin{figure}[H]
	  \centering
	  \includegraphics[width=6cm, keepaspectratio]{img/movil.png}
	  \caption{Diseño \emph{responsive} en móvil}
	  \label{fig:disenoResponsiveMovil}
\end{figure}

Por último, se ha utilizado la biblioteca Angular Material para ciertas vistas, por ejemplo para crear la tabla de pedidos que realiza un usuario. Esta biblioteca permite crear componentes \emph{responsive} de manera sencilla.

\begin{figure}[H]
	  \centering
	  \includegraphics[width=15cm, keepaspectratio]{img/pantalla_grande.png}
	  \caption{Diseño \emph{responsive} en ordenador}
	  \label{fig:disenoResponsiveOrdenador}
\end{figure}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% RESULTADOS %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\cleardoublepage
\chapter{Resultados}

El resultado del trabajo es satisfactorio, ya que se ha cumplido con el objetivo principal del mismo: crear una tienda \emph{online} de electrodomésticos. Si se hace una comparativa con otras tiendas \emph{online}, se puede decir que la aplicación desarrollada está a la altura de las que se ven en el mercado \emph{online} de electrodomésticos.

\section{Consecución de objetivos}
\label{sec:consecucion-objetivos}

Con la implementación de la aplicación se ha conseguido cumplir con los objetivos específicos que se marcaban en el capítulo 2, pues: 

\begin{itemize}
	\item La aplicación es \emph{responsive}. Si se observan las imágenes~\ref{fig:disenoResponsiveMovil} y~\ref{fig:disenoResponsiveOrdenador}, se ve como la aplicación se adapta a diferentes tamaños de pantalla. Para cumplir con este objetivo se ha recurrido al uso de Bootstrap, CSS3 y Angular Material como se ha explicado en el capítulo 4. 
	\item La interfaz de usuario es una interfaz sencilla, en la que los componentes que se utilizan son muy intuitivos. La mayoría de estos componentes se encuentran en casi todas las web de comercio electrónico como, por ejemplo, los botones denominados \emph{dropdown}. Además, se ha usado gran número de iconos que identifican las funcionalidades que realiza cada botón. 
	\item La aplicación cumple con la normativa de protección de datos. Para llevar a cabo este objetivo se ha creado una política de privacidad, donde se informa al usuario como van a ser tratados sus datos. 
	En cuanto a la seguridad de los datos susceptibles, como son las contraseñas, se ha usado una biblioteca robusta para su cifrado. En la base de datos se guarda esta información cifrada mediante un \emph{hash}. El \emph{hash} esta formado por un \emph{salt} que dificulta conseguir la información mediante ataques de fuerza bruta. 
	En cuanto a los pagos, se realizan a través de APIs externas a la aplicación, para no tener que almacenar los datos bancarios. 
	\item La aplicación es atractiva y competitiva. Se ha implementado las funcionalidades básicas que deben tener las tiendas \emph{online} y, además, se ha implementado un sistema de valoración y votación de productos, que no todas las aplicaciones de comercio electrónico tienen. Esto permite a los usuarios conocer las valoraciones de anteriores compradores. Se ha recurrido al uso de colores, iconos, letras y componentes llamativos para captar la atención de los clientes. De esta manera, se amplía el mercado y la aplicación puede situarse entre las más visitadas del mercado de los electrodomésticos. 
	\item Se ha logrado crear una trastienda de administración sencilla. Permite al administrador de la tienda a gestionar pedidos, crear productos y visualizar clientes de manera rápida, evitando que los pedidos se demoren. Para agilizar la carga masiva de los productos, las marcas y las categorías, se ha implementado un servicio de importación y exportación de ficheros Excel. Además se ha implementado un sistema de mensajería que permite interactuar entre los usuarios y el administrador de la tienda, pudiendo resolver cualquier duda de los usuarios.
	\item Con el uso de Angular, Express y Node.js se ha conseguido crear una aplicación web modulable y escalable, en la que el mantenimiento y la actualización de componentes es sencilla. Cada vista de la aplicación tiene su propio componente, por lo que modificar una vista significaría simplemente modificar el componente asociado a ella. 
	 
\end{itemize}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% CONCLUSIONES %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\cleardoublepage
\chapter{Conclusiones}
\label{chap:conclusiones}

\section{Aplicación de lo aprendido}
\label{sec:aplicacion}

Al realizar este trabajo he puesto en práctica muchos de los conocimientos adquiridos en el grado que estoy cursando, Grado en Tecnologías de la Telecomunicación, sobre todo, aquéllos que están relacionados con el desarrollo de aplicaciones web y con la programación. 

La asignatura que más me ha aportado y ayudado para hacer este trabajo es la cursada en el tercer curso del grado, Desarrollo de Aplicaciones Telemáticas, ya que fue aquí donde aprendí todo lo relacionado con la implementación de aplicaciones web como CSS3, HTML5 y Bootstrap.

En el mismo año cursé la asignatura Ingeniería de Sistemas de la Información. Fue aquí donde tuve el primer contacto con JavaScript, lenguaje de programación utilizado para desarrollar el servidor de la aplicación web de comercio electrónico Nevado. Además, aprendí a manejar Git, que me ha permitido llevar un control de las versiones que iba teniendo del proyecto, de tal forma que si alguna funcionalidad me fallaba podía seguir con otra.

Asignaturas como Fundamentos de la Programación o Programación de Sistemas Telemáticos han significado mucho, ya que aprendí los conocimientos más básicos de la programación. 

Para implementar una aplicación, como la desarrollada en este trabajo, hay que tener conocimientos sobre las peticiones HTTP y saber lo que es un API Rest. Estos conocimientos los adquirí en las asignaturas Sistemas telemáticos y Servicios y aplicaciones telemáticas.

Por último, indicar que aunque muchas de las asignaturas que cursé en esta etapa universitaria no han sido necesarias para este trabajo, sí que me han servido para aprender que todo requiere un esfuerzo y un aprendizaje y que, sin este esfuerzo y aprendizaje, no se consiguen las metas que te propones.

\section{Lecciones aprendidas}
\label{sec:lecciones_aprendidas}

El desarrollo de este trabajo ha supuesto un gran reto, pues es el primer proyecto que he realizado de esta complejidad. Durante el transcurso del grado han sido muchas las prácticas que he realizado, pero en todas tenía las directrices a seguir. A lo primero que me he enfrentado en este trabajo ha sido a la recapitulación de los requisitos que se necesitaban para implementar la aplicación. Este análisis me ha servido para conocer los puntos más importantes del comercio electrónico. 

Al analizar los requerimientos he tenido que hacer un análisis de las distintas arquitecturas que podría tener la aplicación. Esto me ha servido para conocer los distintos tipos de arquitecturas que se utilizan en las aplicaciones de este negocio. Como he mencionado en el Capítulo 4, me decanté por la arquitectura MEAN, ya que era la que más se ajustaba a mis necesidades. El haber implementado esta arquitectura me ha permitido conocer nuevas tecnologías: MongoDB, Express, Angular y Node.js. He aprendido a programar de una manera diferente, ya que con Node.js se programa de manera asíncrona. Con Angular, me he tenido que adentrar en el mundo de TypeScript y en el mundo de las aplicaciones modulares y escalables.

Durante el grado, han sido pocas las veces que he usado base de datos, y cuando las he usado ha sido de manera muy básica, con operaciones sencillas y usando siempre SQL. Utilizar MongoDB me ha permitido aprender otra forma de guardar los datos a través de documentos, en vez de en tablas como hasta ahora. Además, esta aplicación me ha permitido realizar operaciones mucho más complejas, en las que en una misma operación tenía que tocar varias colecciones (tablas en base de datos relacionales). Para ello, he tenido que aprender a hacer agregaciones, que son funciones en las los datos se van transformando,  a través de etapas, hasta que se obtiene el resultado esperado.

Para realizar un diseño atractivo y que se adapte a los tamaños de pantalla más estándares, he aprendido a usar media \emph{queries} de CSS3 y he profundizado en Bootstrap. Además, he conocido la biblioteca Angular Material de Angular. 

La importación y exportación de ficheros, así como la subida de archivos al servidor de Node.js me ha proporcionado tener conocimientos en las bibliotecas  adm-zip, para la decompresión de zip, excel4node para el manipulado de ficheros Excel y multer, para la subida de imágenes al servidor. 

Por último, con este trabajo he aprendido que los grandes logros se consiguen con constancia, dedicación y sacrificio y que, a pesar de todos los problemas que pueden aparecer en el camino, hay que levantarse y luchar por conseguirlos. Que la desesperación y los nervios no son buenos aliados. Que hay que confiar en uno mismo y no ponerse límites. 

\section{Trabajos futuros}
\label{sec:trabajos_futuros}

Todas las aplicaciones web necesitan mantenimiento y la implementada en este trabajo no iba a ser menos. Algunas de las líneas a seguir para mejorar la aplicación son: 

\begin{itemize}
	\item Adaptar la aplicación para que soporte, como segundo lenguaje el inglés. De esta forma, se abriría el mercado al mundo internacional. Para realizar esta mejora, se debería utilizar la biblioteca de angular Ngx-translate. Ngx-translate utiliza ficheros JSON donde se encuentran los textos estáticos de la aplicación traducidos a los idiomas que se desee utilizar. Tiene que existir un fichero por cada idioma y el formato de los ficheros debe ser igual. Para los textos que varían en la aplicación, como, por ejemplo, la descripción de los productos, se debería crear un campo nuevo dentro de la base de datos en el que se encuentre la traducción y a la hora de hacer la petición, mandar el idioma para saber que descripción obtener.
	\item Ampliar el filtrado de productos. A pesar del número de filtros que tiene la aplicación para la búsqueda de productos, se pueden añadir filtros que se adapten a las distintas categorías. Por ejemplo, si se accede a la  categoría de televisores, que aparezca un filtro más para buscar por pulgadas. 
	\item Añadir una lista de favoritos, donde el cliente pueda guardar los productos que le gustan. Así, si vuelve a entrar en la aplicación no tiene que volver a buscar los productos que desea.   
	\item Inicio de sesión a través de Facebook y Google. De este modo, los clientes no tendrían que darse de alta en la aplicación, bastaría que iniciasen sesión con sus credenciales de Facebook y Google. 
\end{itemize}

En cuanto a la parte de administración se podrían introducir las siguientes mejoras: 
\begin{itemize}
	\item Añadir estadísticas y gráficos que ofrezcan información sobre los productos más vendidos, los menos demandados, así como la zona donde más pedidos se realizan. Tener esta información de manera resumida, en forma de gráficos, sería muy útil para el administrador y dueño, ya que sabría lo que debe reforzar para mejorar el servicio. 
	\item Añadir una opción de impresión de cartelería. En la tienda física, se necesitan carteles que promocionen los productos, que contengan la información y precio de los mismos. Toda esta información está almacenada en la base de datos, por lo que con la impresión de estos carteles, a través de la aplicación, se agilizaría el trabajo en tienda física. 
	\item Mejorar el diseño \emph{responsive} de la parte de administración. La aplicación en la parte de administración es \emph{responsive}, pero en ciertas pantallas, los campos de las tablas salen más amontonados, por lo que se podría reducir el número de campos a mostrar en la tabla para que dicha información se vea mejor. 
\end{itemize}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% APÉNDICE(S) %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\cleardoublepage
\appendix

  

\chapter{Manual de Instalación}
\label{app:manualInstalacion}


Para instalar la aplicación y poder utilizarla, en un equipo Windows y en el entorno local, se deben seguir los siguientes pasos: 

\begin{enumerate}
	\item Descargar \textit{Git} desde:

	\textit{https://git-scm.com/download/win}.

	\item Instalar \textit{Git}. 
	\item Clonar el repositorio de \textit{Bitbucket} con la instrucción:

	\emph{git clone https://sandra13@bitbucket.org\slash sandra13\slash proyecto\_v2.git}

	\item Descargar \textit{Node.js} y \textit{npm} desde:

	\textit{https://nodejs.org/es/} 

	\item Instalar \textit{Node.js}. La versión utilizada en la aplicación es 10.16.13 LTS. Esta versión incluye \textit{Node.js} y \textit{npm}.

	\item  Instalar \textit{Nodemon} con la instrucción: 

	\emph{npm install -g nodemon}

	\item Instalar \textit{Angular CLI} con la instrucción: 

	\emph{npm install -g @angular/cli}

	\item Instalar \textit{MongoDB} desde: 

	\textit{https://www.mongodb.com/download-center/community}

	Con la instalación de \textit{MongoDB} se instala \textit{Mongo Compass} (herramienta gráfica que permite interactuar con la base de datos MongoDB).


	\item Importar la base de datos.

	\emph{mongorestore -d Nevado ./Escritorio/Nevado}
\end{enumerate}

	Para iniciar la aplicación se incluyen dos \emph{scripts} .bat dentro del directorio raíz del proyecto, que permiten arrancar la aplicación. Los \emph{scripts} son: 

	\begin{itemize}
		\item \emph{server.bat}, ejecuta el servidor de \textit{Node.js}. Utilizado para arrancar el servidor de la aplicación. 
		\item \emph{client.bat}, ejecuta el servidor de \textit{Angular CLI} con la configuración del  \emph{proxy}. Utilizado para arrancar el cliente de la aplicación.
	\end{itemize}



\chapter{Manual de usuario}
\label{app:manualUsuario}

\section{Registro de un nuevo usuario}
\label{sec:registro}

Para que un nuevo usuario pueda registrarse en la tienda \emph{online} ningún otro usuario debe tener abierta una sesión. Para realizar el registro el usuario deber pulsar el enlace ``Entrar''. 

\begin{figure}[H]
	  \centering
	  \includegraphics[width=14cm, keepaspectratio]{img/Barra_navegacion_entrar.png}
	  \caption{Enlace entrar para registrar usuarios.}
	  \label{fig:registroUsuarios}
\end{figure}

Al pulsar sobre el enlace ``Entrar'' se visualiza el formulario que permite registrar al usuario en la aplicación. El usuario debe rellenar todos los campos que son obligatorios. Cuando se introduce la contraseña en el formulario se comprueba la fortaleza de la misma. 

\begin{figure}[H]
	  \centering
	  \includegraphics[width=8cm, keepaspectratio]{img/registrarse.png}
	  \caption{Formulario registro usuarios.}
	  \label{fig:formularioRegistroUsuarios}
\end{figure}

Si alguno de los campos no tiene un formato correcto o no está relleno y es obligatorio, se muestra un mensaje de error por pantalla y se impide el registro del usuario. 

\begin{figure}[H]
	  \centering
	  \includegraphics[width=14cm, keepaspectratio]{img/errorRegistro.png}
	  \caption{Error al registrar un usuario.}
	  \label{fig:errorRegistroUsuarios}
\end{figure}

Cuando el registro finaliza correctamente se muestra un mensaje indicando al usuario que  debe confirmar la cuenta de usuario para completar el registro. Para confirmar la cuenta, se le envía al usuario un enlace a su correo electrónico. El usuario debe pulsar el enlace recibido para completar el registro. Un usuario que no confirma su cuenta no puede realizar compras en la tienda. 

\begin{figure}[H]
	  \centering
	  \includegraphics[width=16cm, keepaspectratio]{img/mensajeInfoRegister.png}
	  \caption{Mensaje de confirmación de cuenta.}
	  \label{fig:confirmacionRegistroUsuarios}
\end{figure}

\section{Inicio de sesión}
\label{sec:inicioSesion}

El usuario debe pulsar el enlace ``Entrar'' de la barra de navegación. 

\begin{figure}[H]
	  \centering
	  \includegraphics[width=14cm, keepaspectratio]{img/Barra_navegacion_entrar.png}
	  \caption{Enlace entrar para iniciar sesión.}
	  \label{fig:inicioSesionEntrar}
\end{figure}

Al pulsar el enlace ``Entrar'' se visualizan dos pestañas, una para el registro de usuarios y otro para iniciar sesión. El usuario debe pulsar sobre la pestaña ``Entrar''. Al pulsar sobre dicha pestaña se muestra el formulario que permite acceder a la cuenta de usuario. Para iniciar sesión, el usuario debe rellenar la contraseña y el \emph{email} y pulsar el botón ``Entrar''. 

\begin{figure}[H]
	  \centering
	  \includegraphics[width=10cm, keepaspectratio]{img/entrar.png}
	  \caption{Formulario para iniciar sesión.}
	  \label{fig:inicioSesion}
\end{figure}

Si la contraseña o el \emph{email} es incorrecto se muestra un mensaje de error y no se permite el acceso a la cuenta. 

\begin{figure}[H]
	  \centering
	  \includegraphics[width=14cm, keepaspectratio]{img/entrarErroneo.png}
	  \caption{Error al iniciar sesión.}
	  \label{fig:ErrorinicioSesion}
\end{figure}

Si tanto la contraseña como el \emph{email} son correctos, se redirecciona al usuario a la página principal de la tienda \emph{online} y se muestra la barra de navegación del usuario logueado, que contiene un enlace para acceder al perfil de usuario, otro para acceder a los pedidos realizados, otro para mostrar el carrito y otro para cerrar sesión. Si el inicio de sesión se realiza cuando se está tramitando el pedido, al finalizar el \emph{login} se redirecciona a la página \textit{Perfil de usuario}. 

\begin{figure}[H]
	  \centering
	  \includegraphics[width=12cm, keepaspectratio]{img/homePaginaPrincipal.png}
	  \caption{Página principal de la tienda.}
	  \label{fig:finalInicioSesion}
\end{figure}

\section{Restablecer contraseña}
\label{sec:restablecerContrania}

Para restablecer la contraseña el usuario debe pulsar el enlace ``Entrar'' de la barra de navegación y seleccionar la pestaña ``Entrar''. En esta pestaña debe hacer click sobre el enlace ``¿Has olvidado la contraseña?''.

\begin{figure}[H]
	  \centering
	  \includegraphics[width=9cm, keepaspectratio]{img/entrar.png}
	  \caption{Enlace para restablecer contraseña.}
	  \label{fig:enlaceParaRestablecer}
\end{figure}

Al pulsar sobre este enlace se visualiza el formulario que permite restablecer la contraseña. Para ello, el usuario debe introducir el correo electrónico con el que se registró en la aplicación. 

\begin{figure}[H]
	  \centering
	  \includegraphics[width=15cm, keepaspectratio]{img/recuperarContrasenia.png}
	  \caption{Formulario para restablecer la contraseña.}
	  \label{fig:restablecerContrasenia}
\end{figure}

Si el correo introducido no coincide con ninguno de los registrados en la tienda \emph{online} se muestra un mensaje y se impide restablecer la contraseña. 

\begin{figure}[H]
	  \centering
	  \includegraphics[width=15cm, keepaspectratio]{img/errorRecuperarContrasenia.png}
	  \caption{Correo no válido al restablecer contraseña.}
	  \label{fig:errorrestablecerContrasenia}
\end{figure}

Si el correo está registrado en el sistema, se envía un correo electrónico con el enlace que permite modificar las contraseñas. Al abrir el enlace, se muestra el formulario a rellenar para el cambio de contraseña. Este formulario tiene dos campos, ``Contraseña nueva'' y ``Confirmación de la contraseña nueva''.

\begin{figure}[H]
	  \centering
	  \includegraphics[width=15cm, keepaspectratio]{img/contraseniaNueva.png}
	  \caption{Formulario cambio de contraseña.}
	  \label{fig:cambioContrasenia}
\end{figure}
 
Para modificar la contraseña, el usuario debe introducir la misma contraseña en los dos campos y pulsar el botón ``Cambiar contraseña''. Si al pulsar el botón, las dos contraseñas no coinciden se muestra un mensaje de error y no se procede al cambio de contraseña. Si las contraseñas coinciden se actualiza en la base de datos y se redirecciona al usuario al \emph{login}. 

\begin{figure}[H]
	  \centering
	  \includegraphics[width=15cm, keepaspectratio]{img/errorNuevaContrasenia.png}
	  \caption{Error cambio de contraseña.}
	  \label{fig:errorCambioContrasenia}
\end{figure}

\section{Cerrar sesión}
\label{sec:cerrarSesion}

Para cerrar sesión, el usuario debe pulsar el enlace ``Salir'' de la barra de navegación. 

\begin{figure}[H]
	  \centering
	  \includegraphics[width=15cm, keepaspectratio]{img/barraNavegacionLogueado.png}
	  \caption{Enlace Salir.}
	  \label{fig:cerrarSesionEnlace}
\end{figure}

\section{Perfil de usuario}
\label{sec:perfildeusuario}

Un usuario puede acceder a su información personal siempre que haya iniciado sesión en su cuenta. Para ello, debe pulsar sobre el enlace que lleva su nombre en la barra de navegación. 

\begin{figure}[H]
	  \centering
	  \includegraphics[width=15cm, keepaspectratio]{img/barraNavegacionLogueado.png}
	  \caption{Barra de navegación acceso al perfil de usuario.}
	  \label{fig:barraPerfilUsuario}
\end{figure}

Al pulsar sobre el enlace se visualiza un formulario con sus datos personales. La primera vez que acceda a su perfil de usuario todos los campos estarán vacíos, excepto el correo electrónico. El usuario puede modificar sus datos personales tantas veces como lo desee. 

\begin{figure}[H]
	  \centering
	  \includegraphics[width=17cm, keepaspectratio]{img/perfilUsuario.png}
	  \caption{Perfil de usuario.}
	  \label{fig:perfilUsuario}
\end{figure}

El usuario puede tener una dirección de facturación distinta que la dirección donde se van a enviar los pedidos. Para agregar la dirección de envío, debe marcar la opción ``¿Desea utilizar otra dirección para el envío?''. Al marcar esta opción aparece un formulario donde se rellenan los datos de la nueva dirección. Si la opción está marcada, los campos de la dirección de envío son obligatorios. 

 \begin{figure}[H]
	  \centering
	  \includegraphics[width=17cm, keepaspectratio]{img/datosEnvio.png}
	  \caption{Formulario para los datos de la dirección de envío.}
	  \label{fig:datosEnvio}
\end{figure}

Para modificar sus datos, debe rellenar los campos que son obligatorios y pulsar el botón ``Guardar''. Si un campo es incorrecto se muestra un error y no se actualizan los datos. 

\begin{figure}[H]
	  \centering
	  \includegraphics[width=17cm, keepaspectratio]{img/errorPerfilUsuario.png}
	  \caption{Error al actualizar los datos personales.}
	  \label{fig:errorPerfilUsuario}
\end{figure}

 \newpage

\section{Realizar compra}
\label{sec:realizarCompra}

El usuario debe acceder a la página principal de la tienda \emph{online}. 

\begin{figure}[H]
	  \centering
	  \includegraphics[width=12cm, keepaspectratio]{img/homePaginaPrincipal.png}
	  \caption{Página principal de la tienda.}
	  \label{fig:paginaPrincipal2}
\end{figure}

Si en la página principal encuentra el producto que quiere comprar, puede tramitar directamente el pedido o ir a la página \textit{Detalle del producto}. Si en esta página no encuentra lo que desea debe seleccionar una categoría del menú de categorías generales. 


\begin{figure}[H]
	  \centering
	  \includegraphics[width=15cm, keepaspectratio]{img/menuCategorias.png}
	  \caption{Menú categorías generales.}
	  \label{fig:menuCategoriasGenerales}
\end{figure}


Al seleccionar una categoría se redirecciona a la página de \textit{subcategorías} de la categoría general. En está página debe elegir la subcategoría donde se encuentra el producto que busca. 


\begin{figure}[H]
	  \centering
	  \includegraphics[width=12cm, keepaspectratio]{img/subcategorias.png}
	  \caption{Subcategorías.}
	  \label{fig:subcategorias}
\end{figure}

Para seleccionar la subcategoría, el usuario debe pulsar sobre la imagen. Al pulsar, se visualiza el listado de productos que tiene la subcategoría seleccionada. 

\begin{figure}[H]
	  \centering
	  \includegraphics[width=13cm, keepaspectratio]{img/listadoProductosSubcategoria.png}
	  \caption{Productos de la subcategoría.}
	  \label{fig:subcategorias2}
\end{figure}

El usuario puede ordenar los productos de más baratos a más caros, de más caros a más baratos, los más vendidos y los mejores valorados. 

\begin{figure}[H]
	  \centering
	  \includegraphics[width=4cm, keepaspectratio]{img/ordenadoProductos.png}
	  \caption{Ordenación de productos.}
	  \label{fig:ordenacionProductos}
\end{figure}

Además, puede filtrar los productos por marca, precio, disponibilidad, ofertas y características. 

\begin{figure}[H]
	  \centering
	  \includegraphics[width=4cm, keepaspectratio]{img/filtros.png}
	  \caption{Filtros.}
	  \label{fig:filtros}
\end{figure}

Desde esta vista, el usuario puede añadir directamente el producto al carrito pulsando sobre el botón ``Comprar'' o ir al detalle del producto. Si el usuario decide ir al detalle del producto debe pulsar sobre la foto del producto. En la vista de \textit{detalle del producto} se visualiza la imagen del producto, el logo de la marca, el modelo, las estrellas y opiniones que tiene el producto, el precio del envío, la disponibilidad, el precio, las características y las opiniones de los usuarios. 

\begin{figure}[H]
	  \centering
	  \includegraphics[width=15cm, keepaspectratio]{img/detalle_producto2.png}
	  \caption{Detalle del producto.}
	  \label{fig:detalleDelProducto}
\end{figure}

Para visualizar las opiniones del producto debe pulsar sobre la pestaña ``Reseñas''. Estas reseñas se pueden filtrar por número de estrellas. Para ello, el usuario debe pulsar sobre la fila de estrellas que desea buscar. 

\begin{figure}[H]
	  \centering
	  \includegraphics[width=15cm, keepaspectratio]{img/reseniasProductos.png}
	  \caption{Reseñas del producto.}
	  \label{fig:reseniasDelProducto}
\end{figure}

Para añadir el producto al carrito, el usuario debe pulsar sobre el botón ``Comprar''. Al pulsar sobre este botón, se redirecciona a la vista de \textit{carrito}, donde el usuario ve los productos que tiene guardados en el carrito. Puede aumentar o disminuir la cantidad de un mismo producto pulsando sobre los botones ``+'' o ``-'', elegir la forma de envío (envío a domicilio o recogida en tienda), siempre y cuando los productos sean diferentes, y eliminar todos los productos del carrito pulsando sobre el botón ``Vaciar cesta''. Si el usuario quiere seguir comprando, debe pulsar el botón ``Seguir comprando''. Si desea finalizar el pedido debe pulsar sobre el botón ``Tramitar Pedido''. 


\begin{figure}[H]
	  \centering
	  \includegraphics[width=15cm, keepaspectratio]{img/carrito.png}
	  \caption{Carrito.}
	  \label{fig:carrito}
\end{figure}

Al pulsar sobre el botón ``Tramitar pedido'' se visualizan los datos personales del usuario (\textit{perfil de usuario}), ya que el usuario debe comprobar que la información guardada es correcta. 


\begin{figure}[H]
	  \centering
	  \includegraphics[width=15cm, keepaspectratio]{img/perfilUsuarioCarrito.png}
	  \caption{Perfil de usuario.}
	  \label{fig:perfilUsuarioCarrito}
\end{figure}

Para finalizar el pedido, el usuario debe pulsar sobre el botón ``Continuar pedido''. Al pulsar sobre este botón, se visualizan los métodos de pago disponibles: Tarjeta de crédito, Paypal y contra reembolso.

\begin{figure}[H]
	  \centering
	  \includegraphics[width=15cm, keepaspectratio]{img/metodosPago.png}
	  \caption{Métodos de pago.}
	  \label{fig:metodosPago}
\end{figure}

 Al seleccionar Tarjeta de crédito, se muestra un formulario donde se han de rellenar los datos relativos a la tarjeta de crédito. Los datos de la tarjeta de crédito deben ser correctos, ya que se comprueba que su formato sea válido.

 \begin{figure}[H]
	  \centering
	  \includegraphics[width=15cm, keepaspectratio]{img/tarjetaBancaria.png}
	  \caption{Formulario tarjeta de crédito.}
	  \label{fig:tarjetaCredito}
\end{figure} 

Si al finalizar el pedido, pulsando sobre el botón ``Finalizar Pedido'' se produce un error, como, por ejemplo, el número de tarjeta es erróneo o el CCV tiene una longitud superior a tres, se muestra un mensaje en la pantalla y no se finaliza el pedido. 

\begin{figure}[H]
	  \centering
	  \includegraphics[width=15cm, keepaspectratio]{img/errorTarjetaCredito.png}
	  \caption{Error al finalizar pedido con tarjeta de crédito.}
	  \label{fig:errortarjetaCredito}
\end{figure} 

Si los datos son correctos, se procesa el pedido y al usuario se le redirecciona a la página principal de la tienda. 


Si el usuario elige como método de pago Contra reembolso, debe marcar la opción contra reembolso y  pulsar sobre el botón ``Finalizar Pedido'', ya que el pago se realiza cuando el producto llegue a su domicilio. Al finalizar el pedido, se redirecciona al usuario a la página principal de la tienda, como con tarjeta de crédito. 

\begin{figure}[H]
	  \centering
	  \includegraphics[width=15cm, keepaspectratio]{img/contrareembolso.png}
	  \caption{Método de pago. Contra reembolso.}
	  \label{fig:contrareembolso}
\end{figure} 


Si el usuario decide que va a realizar el pago a través de Paypal, debe marcar la opción Paypal y pulsar sobre el botón ``Paypal pagar''.

\begin{figure}[H]
	  \centering
	  \includegraphics[width=15cm, keepaspectratio]{img/metodoPaypal.png}
	  \caption{Método de pago. Paypal.}
	  \label{fig:paypal}
\end{figure} 

Cuando pulsa sobre este botón, se abre la ventana de inicio de sesión del sitio web de Paypal, donde debe introducir sus credenciales. 

\begin{figure}[H]
	  \centering
	  \includegraphics[width=15cm, keepaspectratio]{img/paypalInicioSesion.png}
	  \caption{Inicio sesión en Paypal.}
	  \label{fig:inicioSesionPaypal}
\end{figure} 

Una vez el usuario haya iniciado sesión en su cuenta de Paypal, debe elegir como realizar el pago, ya que Paypal permite pagar a través de tarjeta de crédito, transferencia o su cuenta de Paypal. Seleccionada la opción deseada, se pulsa sobre ``Pagar ahora'' para finalizar el pedido. Si todo ha ido correctamente, se cerrará el sitio web de Paypal y se redirecciona al usuario a la página principal de la tienda. 

\begin{figure}[H]
	  \centering
	  \includegraphics[width=15cm, keepaspectratio]{img/pagarAhoraPaypal.png}
	  \caption{Pago con Paypal.}
	  \label{fig:pagoPaypal}
\end{figure} 

\newpage

\section{Tus pedidos}
\label{sec:tusPedidos}

El usuario puede ver los pedidos que ha realizado en la tienda \emph{online} y conocer el estado de cada uno de ellos. Para ello, debe pulsar sobre el enlace ``Pedidos'' de la barra de navegación.

\begin{figure}[H]
	  \centering
	  \includegraphics[width=12cm, keepaspectratio]{img/barraNavegacionLogueado.png}
	  \caption{Enlace pedidos.}
	  \label{fig:enlacePedidos}
\end{figure} 

Al pulsar sobre el enlace, se muestran los pedidos del usuario. 

\begin{figure}[H]
	  \centering
	  \includegraphics[width=15cm, keepaspectratio]{img/tusPedidos.png}
	  \caption{Tabla de pedidos de un usuario.}
	  \label{fig:pedidos}
\end{figure}

El usuario puede filtrar los pedidos por identificador del pedido, estado y fecha en la que se realizó el pedido. Además, puede seleccionar los pedidos que quiere mostrar en la tabla. 

\section{Añadir reseña}
\label{sec:aniadirResenia}

El usuario puede escribir reseñas de los productos de la tienda. Pero, para ello, debe haber iniciado sesión (ver sección~\ref{sec:inicioSesion}). Una vez que el usuario ha iniciado sesión, debe ir a la vista del \textit{detalle del producto} y pulsar sobre ``Escriba una reseña''. 

\begin{figure}[H]
	  \centering
	  \includegraphics[width=11cm, keepaspectratio]{img/detalle_producto2.png}
	  \caption{Enlace para escribir una reseña.}
	  \label{fig:enlaceResenia}
\end{figure}

Al pulsar sobre el enlace se visualiza el formulario para publicar la reseña. El usuario debe rellenar la calificación general, el título, el comentario, sí recomendaría el producto y la valoración del producto en cuanto a calidad precio. Además, de indicar su alias y su correo. 

\begin{figure}[H]
	  \centering
	  \includegraphics[width=13cm, keepaspectratio]{img/EscribirResenia.png}
	  \caption{Ventana para publicar la reseña.}
	  \label{fig:escribeResenia}
\end{figure}

Para publicar la reseña debe pulsar sobre el botón ``Publicar Reseña''. 

\section{Preguntas frecuentes}
\label{sec:preguntasFrecuentes}

Para acceder a la vista de \textit{preguntas frecuentes}, el usuario debe dirigirse al pie de página de la aplicación y pulsar sobre el enlace ``Preguntas frecuentes''. 

\begin{figure}[H]
	  \centering
	  \includegraphics[width=15cm, keepaspectratio]{img/piePagina.png}
	  \caption{Enlace preguntas frecuentes.}
	  \label{fig:EnlacepreguntasFrecuentes}
\end{figure}

Para ver las respuestas de las preguntas, el usuario debe pulsar sobre la pregunta. Al pulsar sobre la pregunta se muestra la respuesta.

\begin{figure}[H]
	  \centering
	  \includegraphics[width=15cm, keepaspectratio]{img/faq.png}
	  \caption{Preguntas frecuentes.}
	  \label{fig:preguntasFrecuentes}
\end{figure}

Desde esta vista, el usuario puede enviar una pregunta al administrador de la tienda. Para ello, debe rellenar el formulario de ``Envía tu pregunta'', pulsar sobre el botón ``Enviar'' y haber iniciado sesión en la tienda. 

\begin{figure}[H]
	  \centering
	  \includegraphics[width=15cm, keepaspectratio]{img/enviaPregunta.png}
	  \caption{Envía su pregunta.}
	  \label{fig:enviaPregunta}
\end{figure}

\section{Quiénes somos}
\label{sec:quienesSomos}

En esta página se encuentra la ubicación de la tienda física, el teléfono y el correo donde dirigirse si el usuario tiene algún problema. Para acceder a esta página el usuario debe pulsar sobre el enlace de ``Quienes somos'' del pie de página. 

\begin{figure}[H]
	  \centering
	  \includegraphics[width=15cm, keepaspectratio]{img/piePagina.png}
	  \caption{Enlace quiénes somos.}
	  \label{fig:Enlacequienes}
\end{figure}

Al pulsar sobre el enlace se muestra la página de \textit{Quiénes somos}. 

\begin{figure}[H]
	  \centering
	  \includegraphics[width=15cm, keepaspectratio]{img/contacto.png}
	  \caption{Quiénes somos.}
	  \label{fig:quienesSomos}
\end{figure}

\newpage

\section{Condiciones de uso}
\label{sec:condicionesUso}

En esta página se definen las condiciones de uso. Se explica como deben efectuarse los pedidos, como se realizan los envíos, como hay que hacer las devoluciones y como es la garantía de los productos. 

\begin{figure}[H]
	  \centering
	  \includegraphics[width=15cm, keepaspectratio]{img/piePagina.png}
	  \caption{Enlace condiciones de uso.}
	  \label{fig:Enlacecondiciones}
\end{figure}

Al pulsar sobre el enlace se muestra la página de \textit{Condiciones de uso}. 

\begin{figure}[H]
	  \centering
	  \includegraphics[width=15cm, keepaspectratio]{img/condicionesUso.png}
	  \caption{Condiciones de uso.}
	  \label{fig:condicionesUso}
\end{figure}


\section{Política de privacidad}
\label{sec:politicaPrivacidad}

En esta página se define la política de privacidad. Por la Ley de Protección de Datos la tienda está obligada a informar a los usuarios como van a ser tratados sus datos. Y son estos, los que deciden si lo aceptan o no. Para acceder, el usuario debe pulsar sobre el enlace ``Política de privacidad''.

\begin{figure}[H]
	  \centering
	  \includegraphics[width=16cm, keepaspectratio]{img/piePagina.png}
	  \caption{Enlace política de privacidad.}
	  \label{fig:Enlaceplitica}
\end{figure}

Al pulsar sobre el enlace se muestra la página de \textit{Política de privacidad}.

\begin{figure}[H]
	  \centering
	  \includegraphics[width=15cm, keepaspectratio]{img/politica.png}
	  \caption{Política de privacidad.}
	  \label{fig:politicaPrivacidad}
\end{figure}

\newpage
\section{Trastienda}
\label{sec:trastienda}

Para entrar en la trastienda, el administrador inicia sesión tal como se indica en la sección~\ref{sec:inicioSesion}. Cuando se inicia sesión, la cabecera de la trastienda muestra un enlace para cerrar sesión y un icono con el número de pedidos pendientes de procesar.

\begin{figure}[H]
	  \centering
	  \includegraphics[width=14cm, keepaspectratio]{img/barraNavegacionAdmin.png}
	  \caption{Barra de navegación del administrador.}
	  \label{fig:barraAdmin}
\end{figure}




El menú que se muestra en la figura~\ref{fig:menuAdmin} permite acceder a cada una de las secciones a administrar.

\begin{figure}[H]
	  \centering
	  \includegraphics[width=3.5cm, keepaspectratio]{img/menuAdmin.png}
	  \caption{Menú.}
	  \label{fig:menuAdmin}
\end{figure}


\subsection{Pedidos}
\label{sec:pedidos}

Al iniciar sesión se muestra la sección \textit{Pedidos}. Esta página es la principal de la trastienda y en ella se muestran todos los pedidos que han realizado los usuarios. Los pedidos están ordenados, por defecto, por la fecha en la que se realizó. Para modificar el orden de los registros se pulsa sobre la cabecera de cada columna. El administrador puede filtrar los resultados rellenando los campos del formulario situado encima de la tabla y pulsando el botón ``Buscar''. En la parte inferior de la tabla se sitúa la barra de paginación, que permite cambiar de página y seleccionar el número de registros a mostrar por página.

\begin{figure}[H]
	  \centering
	  \includegraphics[width=16.5cm, keepaspectratio]{img/tablaPedidos.png}
	  \caption{Sección Pedidos.}
	  \label{fig:tablaPedidos}
\end{figure}

En la parte superior derecha de la tabla se encuentra la barra de herramientas. 

\begin{figure}[H]
	  \centering
	  \includegraphics[width=3.5cm, keepaspectratio]{img/herramientasPedidos.png}
	  \caption{Barra de herramientas.}
	  \label{fig:barraPedidos}
\end{figure}



El primer icono de la izquierda permite recargar los datos de la tabla. El icono central limpia los valores de los filtros cargando de nuevo todos los pedidos. El icono de la derecha permite exportar la tabla a un documento Excel. 

Cada registro tiene dos iconos:

 \begin{figure}[H]
	  \centering
	  \includegraphics[width=3.5cm, keepaspectratio]{img/registroPedidos.png}
	  \caption{Iconos del registro.}
	  \label{fig:iconosPedidos}
\end{figure}

 El icono de la derecha permite generar la factura para aquellos pedidos pagados a contra reembolso. El resto de facturas se generan automáticamente cuando el usuario finaliza el pago. 

 El icono de la izquierda permite mostrar la ficha del pedido. 

\begin{figure}[H]
	  \centering
	  \includegraphics[width=9cm, keepaspectratio]{img/InformacionPedido.png}
	  \caption{Ficha del pedido.}
	  \label{fig:iconosPedidos2}
\end{figure}


 En la ficha del pedido se muestra el listado de productos que el usuario ha comprado, la fecha de entrega, el correo del usuario, si está cobrado y el estado del pedido. El administrador puede marcar el pedido como cobrado o no cobrado y actualizar el estado (preparando, entregado o finalizado). Para guardar los datos se pulsa el botón ``Actualizar pedido''.    

\subsection{Facturas}
\label{sec:Facturas}

En la sección \textit{Facturas} se muestra las facturas generadas en el sistema. Las facturas están ordenadas, por defecto, por número de factura. Para modificar el orden de los registros se pulsa sobre la cabecera de cada columna. El administrador puede filtrar los resultados rellenando los campos del formulario situado encima de la tabla y pulsando el botón ``Buscar''. En la parte inferior de la tabla se sitúa la barra de paginación, que permite cambiar de página y seleccionar el número de registros a mostrar por página.

 \begin{figure}[H]
	  \centering
	  \includegraphics[width=16.5cm, keepaspectratio]{img/facturas.png}
	  \caption{Sección Facturas.}
	  \label{fig:seccionFacturas}
\end{figure} 

En la parte superior derecha de la tabla se encuentra la barra de herramientas. 

\begin{figure}[H]
	  \centering
	  \includegraphics[width=3.5cm, keepaspectratio]{img/herramientasPedidos.png}
	  \caption{Barra de herramientas de Facturas.}
	  \label{fig:barraFacturas}
\end{figure}

El primer icono de la izquierda permite recargar los datos de la tabla. El icono central limpia los valores de los filtros, cargando de nuevo todas los facturas. El icono de la derecha permite exportar la tabla a un documento Excel. 

Cada registro tiene dos iconos:


 \begin{figure}[H]
	  \centering
	  \includegraphics[width=3.5cm, keepaspectratio]{img/iconosFactura.png}
	  \caption{Iconos de una factura.}
	  \label{fig:iconosFacturas}
\end{figure}

 El icono de la derecha permite descargar el PDF de la factura. Véase la figura~\ref{fig:factura}.

 El icono de la izquierda permite mostrar la ficha de la factura.

 \begin{figure}[H]
	  \centering
	  \includegraphics[width=9cm, keepaspectratio]{img/detalleFactura.png}
	  \caption{Ficha de la factura.}
	  \label{fig:detalleFactura}
\end{figure} 

En la ficha de la factura se muestra el listado de productos que el usuario ha comprado, la fecha de facturación, el correo del usuario y el número de la factura. El administrador no puede realizar ninguna modificación sobre la factura.



\subsection{Clientes}
\label{sec:Clientes}

En la sección \textit{Clientes} se muestra los clientes registrados en la tienda. Los clientes están ordenados, por defecto, por nombre. Para modificar el orden de los registros se pulsa sobre la cabecera de cada columna. El administrador puede filtrar los resultados rellenando los campos del formulario situado encima de la tabla y pulsando el botón ``Buscar''. En la parte inferior de la tabla se sitúa la barra de paginación, que permite cambiar de página y seleccionar el número de registros a mostrar por página.

 \begin{figure}[H]
	  \centering
	  \includegraphics[width=16.5cm, keepaspectratio]{img/seccionclientes.png}
	  \caption{Sección Clientes.}
	  \label{fig:seccionClientes}
\end{figure} 

En la parte superior derecha de la tabla se encuentra la barra de herramientas. 

\begin{figure}[H]
	  \centering
	  \includegraphics[width=3.5cm, keepaspectratio]{img/herramientasPedidos.png}
	  \caption{Barra de herramientas de Clientes.}
	  \label{fig:barraclientes}
\end{figure}

El primer icono de la izquierda permite recargar los datos de la tabla. El icono central limpia los valores de los filtros, cargando de nuevo todos los Clientes. El icono de la derecha permite exportar la tabla a un documento Excel. 

Cada registro tiene dos iconos:


 \begin{figure}[H]
	  \centering
	  \includegraphics[width=2.5cm, keepaspectratio]{img/iconosClientes.png}
	  \caption{Iconos de un cliente.}
	  \label{fig:iconoscliente}
\end{figure}

 El icono de la derecha permite eliminar un cliente. El cliente puede pedir que su información personal sea borrada del sistema debido a la Ley de Protección de Datos. Antes de borrar el cliente, el sistema muestra una ventana de confirmación. 

\begin{figure}[H]
	  \centering
	  \includegraphics[width=7.5cm, keepaspectratio]{img/ventanaEliminacion.png}
	  \caption{Ventana de confirmación para eliminar un cliente.}
	  \label{fig:eliminadoCliente}
\end{figure}

  
El icono de la izquierda permite mostrar la ficha del cliente.

 \begin{figure}[H]
	  \centering
	  \includegraphics[width=9cm, keepaspectratio]{img/fichaCliente.png}
	  \caption{Ficha del cliente.}
	  \label{fig:fichaCliente}
\end{figure} 

En la ficha del cliente se muestra los datos personales, incluyendo dirección de facturación, dirección de envío y el número de pedidos que ha realizado en la tienda. El administrador no puede realizar ninguna modificación sobre los datos del cliente.

\subsection{Productos}
\label{sec:productos}

En la sección \textit{Productos} se muestra los productos almacenados en la tienda. Los productos están ordenados, por defecto, por código de producto. Para modificar el orden de los registros se pulsa sobre la cabecera de cada columna. El administrador puede filtrar los resultados rellenando los campos del formulario situado encima de la tabla y pulsando el botón ``Buscar''. En la parte inferior de la tabla se sitúa la barra de paginación, que permite cambiar de página y seleccionar el número de registros a mostrar por página.

 \begin{figure}[H]
	  \centering
	  \includegraphics[width=16.5cm, keepaspectratio]{img/seccionProductos.png}
	  \caption{Sección Productos.}
	  \label{fig:seccionProductos}
\end{figure} 

En la parte superior derecha de la tabla se encuentra la barra de herramientas. 

 \begin{figure}[H]
	  \centering
	  \includegraphics[width=3.5cm, keepaspectratio]{img/barraProductos.png}
	  \caption{Barra de herramientas de productos.}
	  \label{fig:herramientasProductos}
\end{figure}

El primer icono, empezando por la izquierda, permite recargar los datos de la tabla. El segundo icono permite añadir un nuevo producto. El tercer icono limpia los valores de los filtros, cargando de nuevo todos los productos. El último icono permite exportar la tabla a un documento Excel. 

Cada registro tiene dos iconos:

 \begin{figure}[H]
	  \centering
	  \includegraphics[width=2.5cm, keepaspectratio]{img/iconosClientes.png}
	  \caption{Iconos de un Producto.}
	  \label{fig:iconoscliente2}
\end{figure}

El icono de la derecha permite eliminar un producto. Antes de borrar el producto, el sistema muestra una ventana de confirmación. Véase la figura~\ref{fig:eliminadoCliente} 

  
El icono de la izquierda permite mostrar la ficha del producto.

 \begin{figure}[H]
	  \centering
	  \includegraphics[width=12cm, keepaspectratio]{img/detalleProductoAdmin.png}
	  \caption{Ficha del producto.}
	  \label{fig:fichaProducto}
\end{figure} 

En la ficha del producto se muestran todos los datos del producto. El campo características permite añadir formato al texto. El administrador puede modificar todos los campos del producto. Para subir una foto, debe pulsar sobre la imagen y seleccionar la foto que desea subir. Para guardar los cambios debe pulsar el botón ``Guardar''. Esta ventana se utiliza para añadir nuevos productos y para editarlos.

\subsection{Marcas y Categorías}
\label{sec:marcasCategorias}

En la sección \textit{Marcas y Categorías} se muestran las marcas y categorías de los productos almacenados en la tienda, cada una en una tabla diferente. Tanto las marcas como las categorías están ordenados, por defecto, por nombre. Para modificar el orden de los registros se pulsa sobre la cabecera de cada columna. El administrador puede filtrar los resultados rellenando los campos de los formularios situados encima de las tablas y pulsando el botón ``Buscar'' de cada tabla. En la parte inferior de las tablas se sitúan la barras de paginación, que permiten cambiar de página y seleccionar el número de registros a mostrar por página.

 \begin{figure}[H]
	  \centering
	  \includegraphics[width=16.5cm, keepaspectratio]{img/seccionMarcas.png}
	  \caption{Sección Marcas y Categorías.}
	  \label{fig:seccionMarcas}
\end{figure} 

En la parte superior derecha de la tablas se encuentran la barras de herramientas, iguales para ambas tablas. 

 \begin{figure}[H]
	  \centering
	  \includegraphics[width=3.5cm, keepaspectratio]{img/barraProductos.png}
	  \caption{Barra de herramientas de marcas y categorías.}
	  \label{fig:herramientasmarcas2}
\end{figure}

El primer icono, empezando por la izquierda, permite recargar los datos de las tablas. El segundo icono permite añadir un nueva marca o una nueva categoría. El tercer icono limpia los valores de los filtros, cargando de nuevo todas las marcas o todas las categorías. El último icono permite exportar la tablas a los documentos Excel correspondientes. 

Para crear una marca o categoría, el administrador debe rellenar los campos de los formularios y pulsar sobre el recuadro azul que permite seleccionar y subir una foto al servidor. Para finalizar debe pulsar el botón ``Guardar''. 

 \begin{figure}[H]
	  \centering
	  \includegraphics[width=12cm, keepaspectratio]{img/crearMarca.png}
	  \caption{Añadir una marca y una categoría.}
	  \label{fig:crearMarca}
\end{figure}

Cada registro tiene un único icono:

 \begin{figure}[H]
	  \centering
	  \includegraphics[width=2.5cm, keepaspectratio]{img/iconoMarca.png}
	  \caption{Icono de una marca y una categoría.}
	  \label{fig:iconosMarcas}
\end{figure}

El icono permite eliminar la marca o la categoría seleccionada. Antes de borrar el registro seleccionado, el sistema muestra una ventana de confirmación. Véase la figura~\ref{fig:eliminadoCliente} 


\subsection{Ofertas}
\label{sec:ofertas}

En la sección \textit{Ofertas} se muestran las ofertas disponibles en la tienda. Las ofertas están ordenadas, por defecto, por identificador de oferta. Para modificar el orden de los registros se pulsa sobre la cabecera de cada columna. El administrador puede filtrar los resultados rellenando los campos del formulario situado encima de la tabla y pulsando el botón ``Buscar''. En la parte inferior de la tabla se sitúa la barra de paginación, que permite cambiar de página y seleccionar el número de registros a mostrar por página.

 \begin{figure}[H]
	  \centering
	  \includegraphics[width=16.5cm, keepaspectratio]{img/seccionOfertas.png}
	  \caption{Sección Ofertas.}
	  \label{fig:seccionOfertas}
\end{figure} 

En la parte superior derecha de la tabla se encuentra la barra de herramientas. 

 \begin{figure}[H]
	  \centering
	  \includegraphics[width=3.5cm, keepaspectratio]{img/barraProductos.png}
	  \caption{Barra de herramientas de ofertas.}
	  \label{fig:herramientasOfertas}
\end{figure}

El primer icono, empezando por la izquierda, permite recargar los datos de la tabla. El segundo icono permite crear una nueva oferta. El tercer icono limpia los valores de los filtros, cargando de nuevo todas las ofertas. El último icono permite exportar la tabla a un documento Excel. 

Cada registro tiene dos iconos:

 \begin{figure}[H]
	  \centering
	  \includegraphics[width=2.5cm, keepaspectratio]{img/iconosClientes.png}
	  \caption{Iconos de una oferta.}
	  \label{fig:iconoscliente3}
\end{figure}

El icono de la derecha permite eliminar una oferta. Antes de borrar la oferta, el sistema muestra una ventana de confirmación. Véase la figura~\ref{fig:eliminadoCliente} 

  
El icono de la izquierda permite mostrar la ficha de la oferta.

 \begin{figure}[H]
	  \centering
	  \includegraphics[width=12cm, keepaspectratio]{img/fichaOferta.png}
	  \caption{Ficha de la oferta.}
	  \label{fig:fichaOferta2}
\end{figure} 

En la ficha de la oferta se muestra el identificador de la oferta, el porcentaje de descuento, la fecha de inicio de la oferta, la fecha de fin y una pequeña descripción, que explica en que consiste la oferta. El administrador puede modificar todos los campos. Para guardar los cambios debe pulsar el botón ``Guardar''. Esta ventana se utiliza para añadir nuevas ofertas y para editarlas.

\subsection{Servicios}
\label{sec:servicios}

En la sección \textit{Servicios} se muestran los métodos de pagos disponibles en la tienda \emph{online} y las empresas de transporte que realizan los envíos, cada una en una tabla diferente. Tanto los métodos de pago como las empresas están ordenados, por defecto, por nombre. Para modificar el orden de los registros se pulsa sobre la cabecera de cada columna. El administrador puede filtrar los resultados rellenando los campos de los formularios situados encima de las tablas y pulsando el botón ``Buscar'' de cada tabla. En la parte inferior de las tablas se sitúan la barras de paginación, que permiten cambiar de página y seleccionar el número de registros a mostrar por página.

 \begin{figure}[H]
	  \centering
	  \includegraphics[width=16.5cm, keepaspectratio]{img/servicios.png}
	  \caption{Sección Métodos de pago y empresas de transportes.}
	  \label{fig:seccionMarcas2}
\end{figure} 

En la parte superior derecha de las tablas se encuentran las barras de herramientas, iguales para ambas tablas. 

 \begin{figure}[H]
	  \centering
	  \includegraphics[width=3.5cm, keepaspectratio]{img/barraProductos.png}
	  \caption{Barra de herramientas de métodos de pago y Empresas de transportes.}
	  \label{fig:herramientasmarcas}
\end{figure}

El primer icono, empezando por la izquierda, permite recargar los datos de las tablas. El segundo icono permite añadir un nuevo método de pago o una nueva empresa de transporte. El tercer icono limpia los valores de los filtros, cargando de nuevo todos los métodos de pago o todas las empresas de transportes. El último icono permite exportar las tablas a los documentos Excel correspondientes. 

Para crear un método de pago el administrador debe rellenar el campo del los formulario y pulsar sobre el recuadro azul que permite seleccionar y subir una foto al servidor. Para finalizar debe pulsar el botón ``Guardar''. Para crear una nueva empresa de transporte debe rellenar el campo del formulario y pulsar el botón ``Guardar''.

 \begin{figure}[H]
	  \centering
	  \includegraphics[width=12cm, keepaspectratio]{img/metodosEmpresas.png}
	  \caption{Añadir un método de pago y una empresa de transporte.}
	  \label{fig:crearMetodo}
\end{figure}

Cada registro tiene un único icono:

 \begin{figure}[H]
	  \centering
	  \includegraphics[width=2.5cm, keepaspectratio]{img/iconoMarca.png}
	  \caption{Icono de un método de pago y una empresa de transporte.}
	  \label{fig:iconosMarcas2}
\end{figure}

El icono permite eliminar la marca o la categoría seleccionada. Antes de borrar el registro seleccionado, el sistema muestra una ventana de confirmación. Véase la figura~\ref{fig:eliminadoCliente}


\subsection{Mensajes}
\label{sec:mensajes}

En la sección \textit{Mensajes} se muestran los mensajes enviados por los usuarios al administrador. Los mensajes 
están ordenados, por defecto, por nombre. Para modificar el orden de los registros se pulsa sobre la cabecera de cada columna. El administrador puede filtrar los resultados rellenando los campos del formulario situado encima de la tabla y pulsando el botón ``Buscar''. En la parte inferior de la tabla se sitúa la barra de paginación, que permite cambiar de página y seleccionar el número de registros a mostrar por página.

 \begin{figure}[H]
	  \centering
	  \includegraphics[width=16.5cm, keepaspectratio]{img/seccionMensajes.png}
	  \caption{Sección Mensajes.}
	  \label{fig:seccionMensajes}
\end{figure} 

En la parte superior derecha de la tabla se encuentra la barra de herramientas. 

 \begin{figure}[H]
	  \centering
	  \includegraphics[width=3.5cm, keepaspectratio]{img/herramientasPedidos.png}
	  \caption{Barra de herramientas de mensajes.}
	  \label{fig:herramientasMensajes}
\end{figure}

El primer icono, empezando por la izquierda, permite recargar los datos de la tabla. El icono central limpia los valores de los filtros, cargando de nuevo todos los mensajes. El último icono permite exportar la tabla a un documento Excel. 

Cada registro tiene dos iconos:

 \begin{figure}[H]
	  \centering
	  \includegraphics[width=2.5cm, keepaspectratio]{img/iconosClientes.png}
	  \caption{Iconos de un mensaje.}
	  \label{fig:iconoscliente4}
\end{figure}

El icono de la derecha permite eliminar un mensaje. Antes de borrar el mensaje, el sistema muestra una ventana de confirmación. Véase la figura~\ref{fig:eliminadoCliente} 

  
El icono de la izquierda permite mostrar el mensaje.

 \begin{figure}[H]
	  \centering
	  \includegraphics[width=12cm, keepaspectratio]{img/fichaMensaje.png}
	  \caption{Detalle del mensaje.}
	  \label{fig:fichaOferta}
\end{figure} 

En el detalle del mensaje se muestra el nombre y correo del usuario que envío el mensaje, la fecha en que se escribió el mensaje, si está leído o no, el mensaje y un campo de respuesta. El administrador puede responder al usuario rellenando el campo respuesta y pulsando sobre el botón ``Enviar''. La respuesta se enviará al correo electrónico del usuario. Además, puede marcar el mensaje como leído. 

\subsection{Importación}
\label{sec:importacion2}

En la sección \textit{Importación} el administrador puede cargar datos en el sistema de manera masiva. En la parte superior de la página se sitúa un formulario con dos campos y  tres botones. 

 \begin{figure}[H]
	  \centering
	  \includegraphics[width=12cm, keepaspectratio]{img/seccionImportacion.png}
	  \caption{Sección Importación.}
	  \label{fig:importacion}
\end{figure} 

El campo de la izquierda permite elegir el tipo de dato que se desea subir (categorías, marcas o productos). En el segundo campo se adjunta el fichero .zip a importar. Para subir el archivo al servidor, el administrador debe pulsar el botón ``Buscar'' y seleccionar el archivo que desea importar. Para finalizar la importación debe pulsar el botón ``Importar''. Cuando se realiza la importación se muestra por pantalla los registros totales que se han importado y los que han dado error. Además, se indica el error de cada registro. 

 \begin{figure}[H]
	  \centering
	  \includegraphics[width=14.5cm, keepaspectratio]{img/logger.png}
	  \caption{Log de importación.}
	  \label{fig:logImportacion}
\end{figure} 

El botón ``Plantilla'' descarga la plantilla del documento Excel a rellenar del tipo seleccionado. 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% BIBLIOGRAFIA %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\cleardoublepage

% Las siguientes dos instrucciones es todo lo que necesitas
% para incluir las citas en la memoria
\bibliographystyle{abbrv}
\bibliography{memoria}  


 % memoria.bib
% las referencias bibliográficas. Abre ese fichero y mira el formato que tiene,
% que se conoce como BibTeX. Hay muchos sitios que exportan referencias en
% formato BibTeX. Prueba a buscar en http://scholar.google.com por referencias
% y verás que lo puedes hacer de manera sencilla.
% Más información: 
% http://texblog.org/2014/04/22/using-google-scholar-to-download-bibtex-citations/

\end{document}
